/*! For license information please see editor.min.js.LICENSE.txt */
(()=>{var e={341:function(e){e.exports=function(){"use strict";const{entries:e,setPrototypeOf:t,isFrozen:i,getPrototypeOf:a,getOwnPropertyDescriptor:n}=Object;let{freeze:s,seal:o,create:l}=Object,{apply:r,construct:c}="undefined"!=typeof Reflect&&Reflect;r||(r=function(e,t,i){return e.apply(t,i)}),s||(s=function(e){return e}),o||(o=function(e){return e}),c||(c=function(e,t){return new e(...t)});const d=_(Array.prototype.forEach),u=_(Array.prototype.pop),p=_(Array.prototype.push),h=_(String.prototype.toLowerCase),m=_(String.prototype.toString),v=_(String.prototype.match),b=_(String.prototype.replace),f=_(String.prototype.indexOf),g=_(String.prototype.trim),w=_(RegExp.prototype.test),y=(x=TypeError,function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return c(x,t)});var x;function _(e){return function(t){for(var i=arguments.length,a=new Array(i>1?i-1:0),n=1;n<i;n++)a[n-1]=arguments[n];return r(e,t,a)}}function C(e,a,n){n=n||h,t&&t(e,null);let s=a.length;for(;s--;){let t=a[s];if("string"==typeof t){const e=n(t);e!==t&&(i(a)||(a[s]=e),t=e)}e[t]=!0}return e}function k(t){const i=l(null);for(const[a,n]of e(t))i[a]=n;return i}function T(e,t){for(;null!==e;){const i=n(e,t);if(i){if(i.get)return _(i.get);if("function"==typeof i.value)return _(i.value)}e=a(e)}return function(e){return console.warn("fallback value for",e),null}}const $=s(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),A=s(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),S=s(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),E=s(["animate","color-profile","cursor","discard","fedropshadow","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),N=s(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),R=s(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),I=s(["#text"]),F=s(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","xmlns","slot"]),M=s(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),D=s(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),j=s(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),O=o(/\{\{[\w\W]*|[\w\W]*\}\}/gm),L=o(/<%[\w\W]*|[\w\W]*%>/gm),P=o(/\${[\w\W]*}/gm),H=o(/^data-[\-\w.\u00B7-\uFFFF]/),U=o(/^aria-[\-\w]+$/),B=o(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),W=o(/^(?:\w+script|data):/i),z=o(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),G=o(/^html$/i);var V=Object.freeze({__proto__:null,MUSTACHE_EXPR:O,ERB_EXPR:L,TMPLIT_EXPR:P,DATA_ATTR:H,ARIA_ATTR:U,IS_ALLOWED_URI:B,IS_SCRIPT_OR_DATA:W,ATTR_WHITESPACE:z,DOCTYPE_NAME:G});const J=()=>"undefined"==typeof window?null:window;return function t(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:J();const a=e=>t(e);if(a.version="3.0.2",a.removed=[],!i||!i.document||9!==i.document.nodeType)return a.isSupported=!1,a;const n=i.document;let{document:o}=i;const{DocumentFragment:l,HTMLTemplateElement:r,Node:c,Element:x,NodeFilter:_,NamedNodeMap:O=i.NamedNodeMap||i.MozNamedAttrMap,HTMLFormElement:L,DOMParser:P,trustedTypes:H}=i,U=x.prototype,W=T(U,"cloneNode"),z=T(U,"nextSibling"),K=T(U,"childNodes"),q=T(U,"parentNode");if("function"==typeof r){const e=o.createElement("template");e.content&&e.content.ownerDocument&&(o=e.content.ownerDocument)}const Q=function(e,t){if("object"!=typeof e||"function"!=typeof e.createPolicy)return null;let i=null;const a="data-tt-policy-suffix";t.currentScript&&t.currentScript.hasAttribute(a)&&(i=t.currentScript.getAttribute(a));const n="dompurify"+(i?"#"+i:"");try{return e.createPolicy(n,{createHTML:e=>e,createScriptURL:e=>e})}catch(e){return console.warn("TrustedTypes policy "+n+" could not be created."),null}}(H,n),X=Q?Q.createHTML(""):"",{implementation:Y,createNodeIterator:Z,createDocumentFragment:ee,getElementsByTagName:te}=o,{importNode:ie}=n;let ae={};a.isSupported="function"==typeof e&&"function"==typeof q&&Y&&void 0!==Y.createHTMLDocument;const{MUSTACHE_EXPR:ne,ERB_EXPR:se,TMPLIT_EXPR:oe,DATA_ATTR:le,ARIA_ATTR:re,IS_SCRIPT_OR_DATA:ce,ATTR_WHITESPACE:de}=V;let{IS_ALLOWED_URI:ue}=V,pe=null;const he=C({},[...$,...A,...S,...N,...I]);let me=null;const ve=C({},[...F,...M,...D,...j]);let be=Object.seal(Object.create(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),fe=null,ge=null,we=!0,ye=!0,xe=!1,_e=!0,Ce=!1,ke=!1,Te=!1,$e=!1,Ae=!1,Se=!1,Ee=!1,Ne=!0,Re=!1,Ie=!0,Fe=!1,Me={},De=null;const je=C({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let Oe=null;const Le=C({},["audio","video","img","source","image","track"]);let Pe=null;const He=C({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Ue="http://www.w3.org/1998/Math/MathML",Be="http://www.w3.org/2000/svg",We="http://www.w3.org/1999/xhtml";let ze=We,Ge=!1,Ve=null;const Je=C({},[Ue,Be,We],m);let Ke;const qe=["application/xhtml+xml","text/html"];let Qe,Xe=null;const Ye=o.createElement("form"),Ze=function(e){return e instanceof RegExp||e instanceof Function},et=function(e){Xe&&Xe===e||(e&&"object"==typeof e||(e={}),e=k(e),Ke=Ke=-1===qe.indexOf(e.PARSER_MEDIA_TYPE)?"text/html":e.PARSER_MEDIA_TYPE,Qe="application/xhtml+xml"===Ke?m:h,pe="ALLOWED_TAGS"in e?C({},e.ALLOWED_TAGS,Qe):he,me="ALLOWED_ATTR"in e?C({},e.ALLOWED_ATTR,Qe):ve,Ve="ALLOWED_NAMESPACES"in e?C({},e.ALLOWED_NAMESPACES,m):Je,Pe="ADD_URI_SAFE_ATTR"in e?C(k(He),e.ADD_URI_SAFE_ATTR,Qe):He,Oe="ADD_DATA_URI_TAGS"in e?C(k(Le),e.ADD_DATA_URI_TAGS,Qe):Le,De="FORBID_CONTENTS"in e?C({},e.FORBID_CONTENTS,Qe):je,fe="FORBID_TAGS"in e?C({},e.FORBID_TAGS,Qe):{},ge="FORBID_ATTR"in e?C({},e.FORBID_ATTR,Qe):{},Me="USE_PROFILES"in e&&e.USE_PROFILES,we=!1!==e.ALLOW_ARIA_ATTR,ye=!1!==e.ALLOW_DATA_ATTR,xe=e.ALLOW_UNKNOWN_PROTOCOLS||!1,_e=!1!==e.ALLOW_SELF_CLOSE_IN_ATTR,Ce=e.SAFE_FOR_TEMPLATES||!1,ke=e.WHOLE_DOCUMENT||!1,Ae=e.RETURN_DOM||!1,Se=e.RETURN_DOM_FRAGMENT||!1,Ee=e.RETURN_TRUSTED_TYPE||!1,$e=e.FORCE_BODY||!1,Ne=!1!==e.SANITIZE_DOM,Re=e.SANITIZE_NAMED_PROPS||!1,Ie=!1!==e.KEEP_CONTENT,Fe=e.IN_PLACE||!1,ue=e.ALLOWED_URI_REGEXP||B,ze=e.NAMESPACE||We,be=e.CUSTOM_ELEMENT_HANDLING||{},e.CUSTOM_ELEMENT_HANDLING&&Ze(e.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(be.tagNameCheck=e.CUSTOM_ELEMENT_HANDLING.tagNameCheck),e.CUSTOM_ELEMENT_HANDLING&&Ze(e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(be.attributeNameCheck=e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),e.CUSTOM_ELEMENT_HANDLING&&"boolean"==typeof e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements&&(be.allowCustomizedBuiltInElements=e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Ce&&(ye=!1),Se&&(Ae=!0),Me&&(pe=C({},[...I]),me=[],!0===Me.html&&(C(pe,$),C(me,F)),!0===Me.svg&&(C(pe,A),C(me,M),C(me,j)),!0===Me.svgFilters&&(C(pe,S),C(me,M),C(me,j)),!0===Me.mathMl&&(C(pe,N),C(me,D),C(me,j))),e.ADD_TAGS&&(pe===he&&(pe=k(pe)),C(pe,e.ADD_TAGS,Qe)),e.ADD_ATTR&&(me===ve&&(me=k(me)),C(me,e.ADD_ATTR,Qe)),e.ADD_URI_SAFE_ATTR&&C(Pe,e.ADD_URI_SAFE_ATTR,Qe),e.FORBID_CONTENTS&&(De===je&&(De=k(De)),C(De,e.FORBID_CONTENTS,Qe)),Ie&&(pe["#text"]=!0),ke&&C(pe,["html","head","body"]),pe.table&&(C(pe,["tbody"]),delete fe.tbody),s&&s(e),Xe=e)},tt=C({},["mi","mo","mn","ms","mtext"]),it=C({},["foreignobject","desc","title","annotation-xml"]),at=C({},["title","style","font","a","script"]),nt=C({},A);C(nt,S),C(nt,E);const st=C({},N);C(st,R);const ot=function(e){p(a.removed,{element:e});try{e.parentNode.removeChild(e)}catch(t){e.remove()}},lt=function(e,t){try{p(a.removed,{attribute:t.getAttributeNode(e),from:t})}catch(e){p(a.removed,{attribute:null,from:t})}if(t.removeAttribute(e),"is"===e&&!me[e])if(Ae||Se)try{ot(t)}catch(e){}else try{t.setAttribute(e,"")}catch(e){}},rt=function(e){let t,i;if($e)e="<remove></remove>"+e;else{const t=v(e,/^[\r\n\t ]+/);i=t&&t[0]}"application/xhtml+xml"===Ke&&ze===We&&(e='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+e+"</body></html>");const a=Q?Q.createHTML(e):e;if(ze===We)try{t=(new P).parseFromString(a,Ke)}catch(e){}if(!t||!t.documentElement){t=Y.createDocument(ze,"template",null);try{t.documentElement.innerHTML=Ge?X:a}catch(e){}}const n=t.body||t.documentElement;return e&&i&&n.insertBefore(o.createTextNode(i),n.childNodes[0]||null),ze===We?te.call(t,ke?"html":"body")[0]:ke?t.documentElement:n},ct=function(e){return Z.call(e.ownerDocument||e,e,_.SHOW_ELEMENT|_.SHOW_COMMENT|_.SHOW_TEXT,null,!1)},dt=function(e){return"object"==typeof c?e instanceof c:e&&"object"==typeof e&&"number"==typeof e.nodeType&&"string"==typeof e.nodeName},ut=function(e,t,i){ae[e]&&d(ae[e],(e=>{e.call(a,t,i,Xe)}))},pt=function(e){let t;if(ut("beforeSanitizeElements",e,null),(i=e)instanceof L&&("string"!=typeof i.nodeName||"string"!=typeof i.textContent||"function"!=typeof i.removeChild||!(i.attributes instanceof O)||"function"!=typeof i.removeAttribute||"function"!=typeof i.setAttribute||"string"!=typeof i.namespaceURI||"function"!=typeof i.insertBefore||"function"!=typeof i.hasChildNodes))return ot(e),!0;var i;const n=Qe(e.nodeName);if(ut("uponSanitizeElement",e,{tagName:n,allowedTags:pe}),e.hasChildNodes()&&!dt(e.firstElementChild)&&(!dt(e.content)||!dt(e.content.firstElementChild))&&w(/<[/\w]/g,e.innerHTML)&&w(/<[/\w]/g,e.textContent))return ot(e),!0;if(!pe[n]||fe[n]){if(!fe[n]&&mt(n)){if(be.tagNameCheck instanceof RegExp&&w(be.tagNameCheck,n))return!1;if(be.tagNameCheck instanceof Function&&be.tagNameCheck(n))return!1}if(Ie&&!De[n]){const t=q(e)||e.parentNode,i=K(e)||e.childNodes;if(i&&t)for(let a=i.length-1;a>=0;--a)t.insertBefore(W(i[a],!0),z(e))}return ot(e),!0}return e instanceof x&&!function(e){let t=q(e);t&&t.tagName||(t={namespaceURI:ze,tagName:"template"});const i=h(e.tagName),a=h(t.tagName);return!!Ve[e.namespaceURI]&&(e.namespaceURI===Be?t.namespaceURI===We?"svg"===i:t.namespaceURI===Ue?"svg"===i&&("annotation-xml"===a||tt[a]):Boolean(nt[i]):e.namespaceURI===Ue?t.namespaceURI===We?"math"===i:t.namespaceURI===Be?"math"===i&&it[a]:Boolean(st[i]):e.namespaceURI===We?!(t.namespaceURI===Be&&!it[a])&&!(t.namespaceURI===Ue&&!tt[a])&&!st[i]&&(at[i]||!nt[i]):!("application/xhtml+xml"!==Ke||!Ve[e.namespaceURI]))}(e)?(ot(e),!0):"noscript"!==n&&"noembed"!==n||!w(/<\/no(script|embed)/i,e.innerHTML)?(Ce&&3===e.nodeType&&(t=e.textContent,t=b(t,ne," "),t=b(t,se," "),t=b(t,oe," "),e.textContent!==t&&(p(a.removed,{element:e.cloneNode()}),e.textContent=t)),ut("afterSanitizeElements",e,null),!1):(ot(e),!0)},ht=function(e,t,i){if(Ne&&("id"===t||"name"===t)&&(i in o||i in Ye))return!1;if(ye&&!ge[t]&&w(le,t));else if(we&&w(re,t));else if(!me[t]||ge[t]){if(!(mt(e)&&(be.tagNameCheck instanceof RegExp&&w(be.tagNameCheck,e)||be.tagNameCheck instanceof Function&&be.tagNameCheck(e))&&(be.attributeNameCheck instanceof RegExp&&w(be.attributeNameCheck,t)||be.attributeNameCheck instanceof Function&&be.attributeNameCheck(t))||"is"===t&&be.allowCustomizedBuiltInElements&&(be.tagNameCheck instanceof RegExp&&w(be.tagNameCheck,i)||be.tagNameCheck instanceof Function&&be.tagNameCheck(i))))return!1}else if(Pe[t]);else if(w(ue,b(i,de,"")));else if("src"!==t&&"xlink:href"!==t&&"href"!==t||"script"===e||0!==f(i,"data:")||!Oe[e])if(xe&&!w(ce,b(i,de,"")));else if(i)return!1;return!0},mt=function(e){return e.indexOf("-")>0},vt=function(e){let t,i,n,s;ut("beforeSanitizeAttributes",e,null);const{attributes:o}=e;if(!o)return;const l={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:me};for(s=o.length;s--;){t=o[s];const{name:r,namespaceURI:c}=t;if(i="value"===r?t.value:g(t.value),n=Qe(r),l.attrName=n,l.attrValue=i,l.keepAttr=!0,l.forceKeepAttr=void 0,ut("uponSanitizeAttribute",e,l),i=l.attrValue,l.forceKeepAttr)continue;if(lt(r,e),!l.keepAttr)continue;if(!_e&&w(/\/>/i,i)){lt(r,e);continue}Ce&&(i=b(i,ne," "),i=b(i,se," "),i=b(i,oe," "));const d=Qe(e.nodeName);if(ht(d,n,i)){if(!Re||"id"!==n&&"name"!==n||(lt(r,e),i="user-content-"+i),Q&&"object"==typeof H&&"function"==typeof H.getAttributeType)if(c);else switch(H.getAttributeType(d,n)){case"TrustedHTML":i=Q.createHTML(i);break;case"TrustedScriptURL":i=Q.createScriptURL(i)}try{c?e.setAttributeNS(c,r,i):e.setAttribute(r,i),u(a.removed)}catch(e){}}}ut("afterSanitizeAttributes",e,null)},bt=function e(t){let i;const a=ct(t);for(ut("beforeSanitizeShadowDOM",t,null);i=a.nextNode();)ut("uponSanitizeShadowNode",i,null),pt(i)||(i.content instanceof l&&e(i.content),vt(i));ut("afterSanitizeShadowDOM",t,null)};return a.sanitize=function(e){let t,i,s,o,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(Ge=!e,Ge&&(e="\x3c!--\x3e"),"string"!=typeof e&&!dt(e)){if("function"!=typeof e.toString)throw y("toString is not a function");if("string"!=typeof(e=e.toString()))throw y("dirty is not a string, aborting")}if(!a.isSupported)return e;if(Te||et(r),a.removed=[],"string"==typeof e&&(Fe=!1),Fe){if(e.nodeName){const t=Qe(e.nodeName);if(!pe[t]||fe[t])throw y("root node is forbidden and cannot be sanitized in-place")}}else if(e instanceof c)t=rt("\x3c!----\x3e"),i=t.ownerDocument.importNode(e,!0),1===i.nodeType&&"BODY"===i.nodeName||"HTML"===i.nodeName?t=i:t.appendChild(i);else{if(!Ae&&!Ce&&!ke&&-1===e.indexOf("<"))return Q&&Ee?Q.createHTML(e):e;if(t=rt(e),!t)return Ae?null:Ee?X:""}t&&$e&&ot(t.firstChild);const d=ct(Fe?e:t);for(;s=d.nextNode();)pt(s)||(s.content instanceof l&&bt(s.content),vt(s));if(Fe)return e;if(Ae){if(Se)for(o=ee.call(t.ownerDocument);t.firstChild;)o.appendChild(t.firstChild);else o=t;return(me.shadowroot||me.shadowrootmod)&&(o=ie.call(n,o,!0)),o}let u=ke?t.outerHTML:t.innerHTML;return ke&&pe["!doctype"]&&t.ownerDocument&&t.ownerDocument.doctype&&t.ownerDocument.doctype.name&&w(G,t.ownerDocument.doctype.name)&&(u="<!DOCTYPE "+t.ownerDocument.doctype.name+">\n"+u),Ce&&(u=b(u,ne," "),u=b(u,se," "),u=b(u,oe," ")),Q&&Ee?Q.createHTML(u):u},a.setConfig=function(e){et(e),Te=!0},a.clearConfig=function(){Xe=null,Te=!1},a.isValidAttribute=function(e,t,i){Xe||et({});const a=Qe(e),n=Qe(t);return ht(a,n,i)},a.addHook=function(e,t){"function"==typeof t&&(ae[e]=ae[e]||[],p(ae[e],t))},a.removeHook=function(e){if(ae[e])return u(ae[e])},a.removeHooks=function(e){ae[e]&&(ae[e]=[])},a.removeAllHooks=function(){ae={}},a}()}()}},t={};function i(a){var n=t[a];if(void 0!==n)return n.exports;var s=t[a]={exports:{}};return e[a].call(s.exports,s,s.exports,i),s.exports}(()=>{"use strict";const e={modal(e={}){let{header:t="",content:i="",actionsHtml:a=""}=e;return`<div class="vi-wbe-modal-container">\n                    <div class="vi-wbe-modal-main vi-ui form small">\n                        <i class="close icon"></i>\n                        <div class="vi-wbe-modal-wrapper">\n                            <h3 class="header">${t}</h3>\n                            <div class="content">${i}</div>\n                            <div class="actions">${a}</div>\n                        </div>\n                    </div>\n                </div>`},defaultAttributes(e={}){let{html:t}=e;return`<table class="vi-ui celled table">\n                    <thead>\n                    <tr>\n                        <th>Name</th>\n                        <th>Attribute</th>\n                    </tr>\n                    </thead>\n                    <tbody>\n                    ${t}\n                    </tbody>\n                </table>`}},t={},a={};jQuery(document).ready((function(i){window.viIsEditing=!1;const s=wp.media({multiple:!0}),o=wp.media({multiple:!1}),r={galleryImage:(e,t)=>`<li class="vi-wbe-gallery-image" data-id="${t}"><i class="vi-wbe-remove-image dashicons dashicons-no-alt"> </i><img src="${e}"></li>`,fileDownload(e={}){let{id:t,name:a,file:n}=e,s=i(`<tr>\n                        <td><i class="bars icon"></i><input type="text" class="vi-wbe-file-name" value="${a||""}"></td>\n                        <td>\n                            <input type="text" class="vi-wbe-file-url" value="${n||""}">\n                            <input type="hidden" class="vi-wbe-file-hash" value="${t||""}">\n                            <span class="vi-ui button mini vi-wbe-choose-file">${l.text("Choose file")}</span>\n                            <i class="vi-wbe-remove-file dashicons dashicons-no-alt"> </i>\n                        </td>\n                    </tr>`);return s.on("click",".vi-wbe-remove-file",(function(){s.remove()})),s}};t.textEditor={type:"textEditor",createCell:(e,t,a,n)=>(e.innerHTML=l.stripHtml(a).slice(0,i("#vi-wbe-spreadsheet").hasClass("vibulky-spreadsheet-wrap-mode")?500:50),e),closeEditor(e,t){window.viIsEditing=!1;let a="";return!0===t?(a=wp.editor.getContent("vi-wbe-text-editor"),this.isEditing||setTimeout((function(){i(".vi-ui.modal").find(".close.icon").trigger("click")}),100),this.isEditing=!1):wp.editor.remove("vi-wbe-text-editor"),i("#vi-wbe-text-editor").val(""),a},openEditor(e,t,a){window.viIsEditing=!0;let n=e.getAttribute("data-y"),s=e.getAttribute("data-x"),o=a.options.data[n][s],l=this,r=i(".vi-ui.modal .close.icon");i(".vi-ui.modal").modal("show"),this.tinymceInit(o),r.off("click"),i(".vi-wbe-text-editor-save").off("click").on("click",(function(){if(i(this).addClass("loading").removeClass("vi-wbe-text-editor-save-clicking"),i("#vi-wbe-text-editor").is(":visible"))return i(this).addClass("vi-wbe-text-editor-save-clicking"),void i("#vi-wbe-text-editor-tmce").trigger("click");i(this).removeClass("primary loading"),l.isEditing=!i(this).hasClass("vi-wbe-close"),a.closeEditor(e,!0)})),r.on("click",(function(){a.closeEditor(e,!1)})),i(".vi-ui.modal").parent().on("click",(function(t){t.target===t.delegateTarget&&a.closeEditor(e,!1)}))},updateCell(e,t,i){let a=wp.editor.getContent("vi-wbe-text-editor");return a.trim().length>0&&(t=a),e.innerHTML=l.stripHtml(t).slice(0,50),t},tinymceInit(e=""){e=wp.editor.autop(e),null===tinymce.get("vi-wbe-text-editor")&&(i("#vi-wbe-text-editor").val(e),n.tinyMceOptions.tinymce.setup=function(e){e.on("keyup",(function(e){i(".vi-wbe-text-editor-save:not(.vi-wbe-close)").addClass("primary")})),e.on("change",(function(e){setTimeout((function(){i(".vi-wbe-text-editor-save-clicking").length&&i(".vi-wbe-text-editor-save-clicking").trigger("click")}),100)}))},wp.editor.initialize("vi-wbe-text-editor",n.tinyMceOptions)),tinymce.get("vi-wbe-text-editor").setContent(e)}},t.image={createCell(e,t,a,s){if(a){let t=n.imgStorage[a];l.isUrl(t)?i(e).html(`<img width="40" src="${t}" data-id="${a}">`):i(e).html("")}return e},closeEditor:(e,t)=>i(e).find("img").attr("data-id")||"",openEditor(e,t,a){function s(){o.open().off("select").on("select",(function(t){let s=o.state().get("selection").first().toJSON();l.isUrl(s.url)&&(i(e).html(`<img width="40" src="${s.url}" data-id="${s.id}">`),n.imgStorage[s.id]=s.url,a.closeEditor(e,!0))}))}i(e).on("dblclick",s),s()},updateCell(e,t,a){t=parseInt(t)||"";let s=n.imgStorage[t];return l.isUrl(s)?i(e).html(`<img width="40" src="${s}" data-id="${t}">`):i(e).html(""),t}},t.gallery={type:"gallery",saveData(e){let t=[];i(e).find(".vi-wbe-gallery-image").each((function(){t.push(i(this).data("id"))})),i(e).find(".vi-wbe-ids-list").val(t.join(","))},createCell(e,t,a){let n=a.length?"vi-wbe-gallery-has-item":"";return i(e).addClass("vi-wbe-gallery"),i(e).html(`<div class="vi-wbe-gallery ${n}"><i class="images outline icon"> </i></div>`),e},closeEditor(e,t){window.viIsEditing=!1;let a=[];return t&&i(e).children().find(".vi-wbe-gallery-image").each((function(){a.push(i(this).data("id"))})),i(e).find(".vi-wbe-cell-popup").remove(),a},openEditor(e,t,a){window.viIsEditing=!0;let o=e.getAttribute("data-y"),c=e.getAttribute("data-x"),d=a.options.data[o][c],u="";if(d.length)for(let e of d){let t=n.imgStorage[e];u+=r.galleryImage(t,e)}let p=i(`<div class="vi-wbe-cell-popup-inner">\n                                    <ul class="vi-wbe-gallery-images">${u}</ul>\n                                    <span class="vi-ui button tiny vi-wbe-add-image">${l.text("Add image")}</span>\n                                    <span class="vi-ui button tiny vi-wbe-remove-gallery">${l.text("Remove all")}</span>\n                                </div>`);l.createEditor(e,"div",p),p.find(".vi-wbe-gallery-images").sortable({items:"li.vi-wbe-gallery-image",cursor:"move",scrollSensitivity:40,forcePlaceholderSize:!0,forceHelperSize:!1,helper:"clone",placeholder:"vi-wbe-sortable-placeholder",tolerance:"pointer"}),p.on("click",".vi-wbe-remove-image",(function(){i(this).parent().remove()})),p.on("click",".vi-wbe-add-image",(function(){s.open().off("select close").on("select",(function(e){s.state().get("selection").each((function(e){"image"===(e=e.toJSON()).type&&(n.imgStorage[e.id]=e.url,p.find(".vi-wbe-gallery-images").append(r.galleryImage(e.url,e.id)))}))}))})),p.on("click",".vi-wbe-remove-gallery",(function(){p.find(".vi-wbe-gallery-images").empty()})),0===d.length&&p.find(".vi-wbe-add-image").trigger("click")},updateCell(e,t,a){let n=i(e).find(".vi-wbe-gallery");return t.length?n.addClass("vi-wbe-gallery-has-item"):n.removeClass("vi-wbe-gallery-has-item"),t}},t.download={createCell:(e,t,a)=>(i(e).html('<div><i class="download icon"> </i></div>'),e),closeEditor(e,t){let a=[];if(t){let t=i(e).children();t.find("table.vi-wbe-files-download tbody tr").each((function(){let e=i(this);a.push({id:e.find(".vi-wbe-file-hash").val(),file:e.find(".vi-wbe-file-url").val(),name:e.find(".vi-wbe-file-name").val()})})),t.remove()}return a},openEditor(e,t,a){let n,s=e.getAttribute("data-y"),c=e.getAttribute("data-x"),d=a.options.data[s][c],u=i("<tbody></tbody>");if(Array.isArray(d))for(let e of d)u.append(r.fileDownload(e));let p=i(`<div class="">\n                                        <table class="vi-wbe-files-download vi-ui celled table">\n                                            <thead>\n                                            <tr>\n                                                <th>${l.text("Name")}</th>\n                                                <th>${l.text("File URL")}</th>\n                                            </tr>\n                                            </thead>\n                                        </table>\n                                        <span class="vi-ui button tiny vi-wbe-add-file">${l.text("Add file")}</span>\n                                    </div>`);p.find(".vi-wbe-files-download").append(u),l.createEditor(e,"div",p),u.sortable(),p.on("click",".vi-wbe-add-file",(()=>p.find(".vi-wbe-files-download tbody").append(r.fileDownload()))),p.on("click",".vi-wbe-choose-file",(function(){n=a.edition,a.edition=null;let e=i(this).closest("tr");o.open().off("select close").on("select",(function(t){let i=o.state().get("selection").first().toJSON();i.url&&e.find(".vi-wbe-file-url").val(i.url).trigger("change")})).on("close",(()=>a.edition=n))})),d.length||p.find(".vi-wbe-add-file").trigger("click")},updateCell:(e,t,a)=>(i(e).html('<div><i class="download icon"> </i></div>'),t)},t.tags={type:"tags",createCell:(e,t,i,a)=>(l.formatText(e,i),e),openEditor(e,t,a){let s,o=e.getAttribute("data-y"),r=e.getAttribute("data-x"),c=a.options.data[o][r],d=i('<select class="bulky-select-tag" />'),u=i('<span class="vi-ui button mini basic">Add</span>'),p=l.createEditor(e,"div",'<div style="display: flex; gap: 10px;"><div class="bulky-select-tag-wrapper" style="width: 100%;"></div><div class="bulky-add-select-tag"></div></div>');i(p).find(".bulky-select-tag-wrapper").append(d),i(p).find(".bulky-add-select-tag").append(u),d.select2({data:c,multiple:!0,minimumInputLength:3,placeholder:l.text("Search tags..."),ajax:{url:n.ajaxUrl,type:"post",data:function(e){return{...n.ajaxData,sub_action:"search_tags",search:e.term,type:"public"}},processResults:function(e){return{results:e}}}}).on("select2:select",(function(e){s=""})),d.find("option").attr("selected",!0).parent().trigger("change"),i("body").on("change",".select2-search__field",(function(){s=i(this).val()})),u.on("click",(function(){if(s){let e=new Option(s,s,!0,!0);i(p).find(".bulky-select-tag").append(e).trigger("change"),s=""}}))},closeEditor(e,t){let a=i(e).children(),n=a.find("select").select2("data"),s=[];if(n.length)for(let e of n)s.push({id:e.id,text:e.text});return a.remove(),i(".select2-container").remove(),s},updateCell:(e,t,i,a,n)=>(l.formatText(e,t),t)},t.link_products={createCell:(e,t,i,a)=>(l.formatText(e,i),e),closeEditor(e,t){let a=i(e).children(),n=[];if(t){let e=a.find("select").select2("data");if(e.length)for(let t of e)n.push({id:t.id,text:t.text})}return a.remove(),i(".select2-container").remove(),n},openEditor(e,t,a){let s=e.getAttribute("data-y"),o=e.getAttribute("data-x"),r=a.options.data[s][o],c=i("<select/>"),d=l.createEditor(e,"div",c);c.select2({data:r,multiple:!0,minimumInputLength:3,placeholder:l.text("Search products..."),ajax:{url:n.ajaxUrl,type:"post",delay:250,dataType:"json",data:function(e){return{...n.ajaxData,sub_action:"search_products",search:e.term,type:"public"}},processResults:function(e){var t=[];return e&&i.each(e,(function(e,i){t.push({id:e,text:i})})),{results:t}}}}),c.find("option").attr("selected",!0).parent().trigger("change"),i(d).find(".select2-search__field").trigger("click")},updateCell:(e,t,i,a,n)=>(l.formatText(e,t),t)},t.product_attributes={type:"product_attributes",createCell(e,t,a,n){let s=Object.keys(a).length?"vi-wbe-has-attrs":"";return i(e).html(`<div class="vi-wbe-product-attrs ${s}"><i class="icon edit"/></div>`),e},updateCell(e,t,a,n,s){let o=i(e).find(".vi-wbe-product-attrs");return Object.keys(t).length?o.addClass("vi-wbe-has-attrs"):o.removeClass("vi-wbe-has-attrs"),t},openEditor(e,t,a){let s=l.getDataFromCell(a,e),o=l.getProductTypeFromCell(e),r=this,c="";this.productType=o;let d=l.createModal({header:l.text("Edit attributes"),content:"",actions:[{class:"save-attributes",text:l.text("Save")}],silent:!0});if(i(e).append(d),"variation"!==o){let{attributes:e}=n,t=`<option value="">${l.text("Custom product attribute")}</option>`;for(let i in e)t+=`<option value="${i}">${e[i].data.attribute_label}</option>`;if(t=`<div class="vi-wbe-taxonomy-header">\n                                    <select class="vi-wbe-select-taxonomy">${t}</select>\n                                    <span class="vi-ui button tiny vi-wbe-add-taxonomy">${l.text("Add")}</span>\n                                </div>`,Array.isArray(s)&&s.length)for(let e of s)c+=r.createRowTable(e);c=`${t}\n                        <table class="vi-ui celled table">\n                            <thead>\n                            <tr>\n                                <th>Name</th>\n                                <th>Attributes</th>\n                                <th width="1">Actions</th>\n                            </tr>\n                            </thead>\n                            <tbody>${c}</tbody>\n                        </table>`,d.find(".content").append(c),d.find("table select").select2({multiple:!0}),d.find("tbody").sortable({items:"tr",cursor:"move",axis:"y",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",handle:".icon.move"});const a=()=>{d.find("select.vi-wbe-select-taxonomy option").removeAttr("disabled"),d.find("input[type=hidden]").each((function(e,t){let a=i(t).val();d.find(`select.vi-wbe-select-taxonomy option[value='${a}']`).attr("disabled","disabled")}))};a(),d.on("click",(function(e){let t=i(e.target);if(t.hasClass("trash")&&(t.closest("tr").remove(),a()),t.hasClass("vi-wbe-add-taxonomy")){let e=i(".vi-wbe-select-taxonomy"),t=e.val(),n={name:t,options:[]};t&&(n.is_taxonomy=1);let s=i(r.createRowTable(n));d.find("table tbody").append(s),s.find("select").select2({multiple:!0}),a(),e.val("").trigger("change")}if(t.hasClass("vi-wbe-select-all-attributes")){let e=t.closest("td").find("select");e.find("option").attr("selected",!0),e.trigger("change")}if(t.hasClass("vi-wbe-select-no-attributes")){let e=t.closest("td").find("select");e.find("option").attr("selected",!1),e.trigger("change")}if(t.hasClass("vi-wbe-add-new-attribute")){let e=prompt(l.text("Enter a name for the new attribute term:"));if(!e)return;let i=t.closest("tr.vi-wbe-attribute-row"),a=i.attr("data-attr");a&&(a=JSON.parse(a),l.ajax({data:{sub_action:"add_new_attribute",taxonomy:a.name,term:e},beforeSend(){t.addClass("loading")},success(e){if(e.success){let t=i.find("select");t.append(`<option value="${e.data.term_id}" selected>${e.data.name}</option>`),t.trigger("change"),n.attributes[a.name].terms[e.data.term_id]={slug:e.data.slug,text:e.data.name}}else alert(e.data.message)},error(e){console.log(e),alert(e.statusText+e.responseText)},complete(){t.removeClass("loading")}}))}}))}else{let t,i=e.getAttribute("data-y"),o=a.options.data[i][1],r=a.getData();for(let e in r)if(o==r[e][0]){let i=n.idMappingFlip.attributes;t=a.options.data[e][i];break}if(t)for(let e of t){let t,i=`<option value="">${l.text("Any...")}</option>`,a=e.name;if(e.is_taxonomy){let o=n.attributes[a];for(let t of e.options){let e=o.terms[t],n=e.slug===s[a]?"selected":"";i+=`<option value="${e.slug}" ${n}>${e.text}</option>`}t=o.data.attribute_label}else{for(let t of e.options)i+=`<option value="${t}" ${t===s[a]?"selected":""}>${t}</option>`;t=a}c+=`<tr><td>${t}</td><td><select name="${a}">${i}</select></td></tr>`}c=`<table class="vi-ui celled table">\n                            <thead>\n                            <tr>\n                                <th>${l.text("Attribute")}</th>\n                                <th>${l.text("Option")}</th>\n                            </tr>\n                            </thead>\n                            <tbody>\n                            ${c}\n                            </tbody>\n                        </table>`,d.find(".content").append(c)}d.on("click",(function(t){let n=i(t.target);(n.hasClass("close")||n.hasClass("vi-wbe-modal-container"))&&a.closeEditor(e,!1),n.hasClass("save-attributes")&&a.closeEditor(e,!0)}))},closeEditor(e,t){let a=[];return!0===t&&("variation"!==this.productType?i(e).find(".vi-wbe-attribute-row").each((function(e,t){let n=i(t).data("attr");if(n.is_taxonomy)n.options=i(t).find("select").val().map(Number);else{n.name=i(t).find("input.custom-attr-name").val();let e=i(t).find("textarea.custom-attr-val").val();n.value=e.trim().replace(/[^\S\n]+/g," "),n.options=e.split("|").map((e=>e.trim().replace(/[^\S\n]+/g," ")))}n.visible=!!i(t).find(".attr-visibility:checked").length,n.variation=!!i(t).find(".attr-variation:checked").length,n.position=e,a.push(n)})):(a={},i(e).find("select").each((function(e,t){a[i(t).attr("name")]=i(t).val()})))),l.removeModal(e),a},createRowTable(e){let t="",i="";if(e.is_taxonomy){let a=n.attributes[e.name],s=a.terms||[],o="";if(t=`${a.data.attribute_label}<input type="hidden" value="${e.name}"/>`,Object.keys(s).length)for(let t in s)o+=`<option value="${t}" ${e.options.includes(parseInt(t))?"selected":""}>${s[t].text}</option>`;i=`<select multiple>${o}</select>\n                        <div class="vi-wbe-attributes-button-group">\n                            <span class="vi-ui button mini vi-wbe-select-all-attributes">${l.text("Select all")}</span>\n                            <span class="vi-ui button mini vi-wbe-select-no-attributes">${l.text("Select none")}</span>\n                            <span class="vi-ui button mini vi-wbe-add-new-attribute">${l.text("Add new")}</span>\n                        </div>`}else t=`<input type="text" class="custom-attr-name" value="${e.name}" placeholder="${l.text("Custom attribute name")}"/>`,i=`<textarea class="custom-attr-val" placeholder="${l.text('Enter some text, or some attributes by "|" separating values.')}">${e.value||""}</textarea>`;return t=`<div class="vi-wbe-attribute-name-label">${t}</div>`,t+=`<div>\n                            <input type="checkbox" class="attr-visibility" ${e.visible?"checked":""} value="1">\n                            <label>${l.text("Visible on the product page")}</label>\n                        </div>`,"variable"===this.productType&&(t+=`<div>\n                                <input type="checkbox" class="attr-variation" ${e.variation?"checked":""} value="1">\n                                <label>${l.text("Used for variations")}</label>\n                            </div>`),`<tr class="vi-wbe-attribute-row" data-attr='${JSON.stringify(e)}'>\n                        <td class="vi-wbe-left">${t}</td>\n                        <td>${i}</td>\n                        <td class="vi-wbe-right"><i class="icon trash"> </i> <i class="icon move"> </i></td>\n                    </tr>`}},t.default_attributes={createCell:(e,t,a,n)=>(a&&i(e).text(Object.values(a).filter(Boolean).join("; ")),e),updateCell:(e,t,a,n,s)=>(t?i(e).text(Object.values(t).filter(Boolean).join("; ")):i(e).text(""),t),openEditor(t,a,s){let o=l.getDataFromCell(s,t),r=l.getProductTypeFromCell(t),c="";if(this.productType=r,"variable"===r){let a=l.createModal({header:l.text("Set default attributes"),content:"",actions:[{class:"save-attributes",text:l.text("Save")}]});i(t).append(a);let r=t.getAttribute("data-y"),d=n.idMappingFlip.attributes,u=s.options.data[r][d];if(Array.isArray(u)&&u.length)for(let e of u){if(0===e.options.length)continue;let t="",i="";if(e.is_taxonomy){let a=n.attributes[e.name];t=a.data.attribute_label;for(let t of e.options){let n=a.terms[t],s=n.slug===o[e.name]?"selected":"";i+=`<option value="${l.htmlEncode(n.slug)}" ${s}>${n.text}</option>`}}else{t=e.attribute_label;for(let t of e.options){let a=t===o[e.name]?"selected":"";i+=`<option value="${l.htmlEncode(t)}" ${a}>${t}</option>`}}i=`<option value="">No default ${t}</option> ${i}`,c+=`<tr><td>${t}</td><td><select name="${e.name}" class="vi-wbe-default-attribute">${i}</select></td></tr>`}a.find(".content").append(e.defaultAttributes({html:c})),a.on("click",(function(e){let a=i(e.target);(a.hasClass("close")||a.hasClass("vi-wbe-modal-container"))&&s.closeEditor(t,!1),a.hasClass("save-attributes")&&s.closeEditor(t,!0)}))}},closeEditor(e,t){let a={};return!0===t&&i(e).find(".vi-wbe-default-attribute").each(((e,t)=>a[i(t).attr("name")]=i(t).val())),l.removeModal(e),a}},t.array={createCell:(e,t,a,n)=>(i(e).html(a?JSON.stringify(a):a),e),closeEditor(e,t){let i=[];return!0===t&&(i=this.editor.get()),l.removeModal(e),i},openEditor(e,t,a){let n=l.getDataFromCell(a,e),s=l.createModal({header:l.text("Edit metadata"),content:"",actions:[{class:"save-metadata",text:l.text("Save")}]});i(e).append(s),s.find(".content").html('<div id="vi-wbe-jsoneditor"></div>');let o=s.find("#vi-wbe-jsoneditor").get(0);this.editor=new JSONEditor(o,{enableSort:!1,search:!1,enableTransform:!1}),this.editor.set(n),s.on("click",(function(t){let n=i(t.target);(n.hasClass("close")||n.hasClass("vi-wbe-modal-container"))&&a.closeEditor(e,!1),n.hasClass("save-metadata")&&a.closeEditor(e,!0)}))},updateCell:(e,t,a)=>(i(e).html(t?JSON.stringify(t):t),t)},t.order_notes={createCell(e,t,a,n){let s=a.length?"vi-wbe-gallery-has-item":"";return i(e).html(`<div class="${s}"><i class="icon eye"/></div>`),this.obj=n,e},closeEditor(e,t){return i(e).find(".vi-wbe-cell-popup").remove(),this.notes},openEditor(e,t,a){let n=e.getAttribute("data-y"),s=e.getAttribute("data-x"),o=a.options.data[n][s],r="";if(this.notes=o,o.length)for(let e of o){let t=e.content.replace(/(?:\r\n|\r|\n)/g,"<br>");r+=`<div class="vi-wbe-note-row">\n                                <div class="vi-wbe-note-row-content ${e.customer_note?"customer":"system"===e.added_by?"system":"private"}">${t}</div>\n                                <span class="vi-wbe-note-row-meta">\n                                    ${e.date}\n                                    <a href="#" data-comment_id="${e.id}" class="vi-wbe-note-row-delete">${l.text("Delete")}</a>\n                                </span>\n                            </div>`}let c=i(`<div class="vi-wbe-cell-popup-inner">${r}</div>`);l.createEditor(e,"div",c),c.on("click",".vi-wbe-note-row-delete",(function(){let e=i(this),t=e.data("comment_id");t&&l.ajax({data:{sub_action:"delete_order_note",id:t},beforeSend(){l.loading()},success(i){if(i.success){let i=o.findIndex((e=>e.id===t));o.splice(i,1),e.closest(".vi-wbe-note-row").remove()}},error(e){console.log(e),alert(e.statusText+e.responseText)},complete(){l.removeLoading()}})}))},updateCell:(e,t,i)=>t},t.select2={type:"select2",createCell(e,t,i,a){let{source:n}=a.options.columns[t],s=[];return Array.isArray(i)||(i=Object.values(i)),Array.isArray(n)&&n.length&&(s=n.filter((e=>i.includes(e.id)))),l.formatText(e,s),e},openEditor(e,t,a){let n=e.getAttribute("data-y"),s=e.getAttribute("data-x"),o=a.options.data[n][s],r=i("<select/>"),{source:c,multiple:d,placeholder:u}=a.options.columns[s],p=l.createEditor(e,"div",r);r.select2({data:c||[],multiple:d,placeholder:u}),r.val(o).trigger("change"),i(p).find(".select2-search__field").trigger("click")},closeEditor(e,t){let a=i(e).children(),n=a.find("select").val();return n=n.map((e=>isNaN(e)?e:+e)),a.remove(),i(".select2-container").remove(),n},updateCell(e,t,i,a,n){let{source:s}=a.options.columns[n],o=[];return Array.isArray(s)&&s.length&&(o=s.filter((e=>t.includes(e.id)))),l.formatText(e,o),t}},a.sourceForVariation=(e,t,i,a,n)=>{let s=n.options.columns[i].source;return"variation"===l.getProductTypeFromCell(t)&&(s=n.options.columns[i].subSource),s}}));const n={...wbeParams,productTypes:{},filterKey:Date.now(),selectPage:1,ajaxData:{action:"vi_wbe_ajax",vi_wbe_nonce:wbeParams.nonce},tinyMceOptions:{tinymce:{theme:"modern",skin:"lightgray",language:"en",formats:{alignleft:[{selector:"p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li",styles:{textAlign:"left"}},{selector:"img,table,dl.wp-caption",classes:"alignleft"}],aligncenter:[{selector:"p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li",styles:{textAlign:"center"}},{selector:"img,table,dl.wp-caption",classes:"aligncenter"}],alignright:[{selector:"p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li",styles:{textAlign:"right"}},{selector:"img,table,dl.wp-caption",classes:"alignright"}],strikethrough:{inline:"del"}},relative_urls:!1,remove_script_host:!1,convert_urls:!1,browser_spellcheck:!0,fix_list_elements:!0,entities:"38,amp,60,lt,62,gt",entity_encoding:"raw",keep_styles:!1,cache_suffix:"wp-mce-49110-20201110",resize:"vertical",menubar:!1,branding:!1,preview_styles:"font-family font-size font-weight font-style text-decoration text-transform",end_container_on_empty_block:!0,wpeditimage_html5_captions:!0,wp_lang_attr:"en-US",wp_keep_scroll_position:!1,wp_shortcut_labels:{"Heading 1":"access1","Heading 2":"access2","Heading 3":"access3","Heading 4":"access4","Heading 5":"access5","Heading 6":"access6",Paragraph:"access7",Blockquote:"accessQ",Underline:"metaU",Strikethrough:"accessD",Bold:"metaB",Italic:"metaI",Code:"accessX","Align center":"accessC","Align right":"accessR","Align left":"accessL",Justify:"accessJ",Cut:"metaX",Copy:"metaC",Paste:"metaV","Select all":"metaA",Undo:"metaZ",Redo:"metaY","Bullet list":"accessU","Numbered list":"accessO","Insert/edit image":"accessM","Insert/edit link":"metaK","Remove link":"accessS","Toolbar Toggle":"accessZ","Insert Read More tag":"accessT","Insert Page Break tag":"accessP","Distraction-free writing mode":"accessW","Add Media":"accessM","Keyboard Shortcuts":"accessH"},plugins:"charmap,colorpicker,hr,lists,media,paste,tabfocus,textcolor,fullscreen,wordpress,wpautoresize,wpeditimage,wpemoji,wpgallery,wplink,wpdialogs,wptextpattern,wpview",selector:"#vi-wbe-text-editor",wpautop:!0,indent:!1,toolbar1:"formatselect,bold,italic,bullist,numlist,blockquote,alignleft,aligncenter,alignright,link,wp_more,spellchecker,fullscreen,wp_adv",toolbar2:"strikethrough,hr,forecolor,pastetext,removeformat,charmap,outdent,indent,undo,redo,wp_help",tabfocus_elements:":prev,:next",body_class:"excerpt post-type-product post-status-publish page-template-default locale-en-us"},mediaButtons:!0,quicktags:!0},setColumns(e){try{let i=JSON.parse(e);n.columns=i.map((e=>(e&&e.editor&&t[e.editor]&&(e.editor=t[e.editor]),e&&e.filter&&a[e.filter]&&(e.filter=a[e.filter]),e)))}catch(e){console.log(e)}}};window.Attributes=n;const s=wbeI18n.i18n,o=jQuery,l={setJexcel(e){this.jexcel=e},text:e=>s[e]||e,isUrl:e=>/^(http(s?):)\/\/.*\.(?:jpg|jpeg|gif|png|webp)$/i.test(e),formatText(e,t){let i="";if(t.length)for(let e=0;e<t.length;e++)t[e]&&(i+=t[e].text+"; ");e.innerText=i},createEditor(e,t,i="",a=!0){let n=document.createElement(t);"div"===t&&o(n).append(i),n.style.minWidth="300px";let s=o(n).innerHeight(),l=o(e).offset(),r=l.left,c=l.top,d=o(e).innerWidth(),u=e.getBoundingClientRect();a?(n.style.minHeight=u.height-2+"px",n.style.maxHeight=window.innerHeight-c-50+"px"):(n.style.opacity=0,n.style.fontSize=0),n.classList.add("vi-ui","segment","vi-wbe-cell-popup","vi-wbe-editing"),e.classList.add("editor"),e.appendChild(n);let p=o(n).innerWidth();if(o(this.jexcel.el).innerWidth()<r+p+d){let e=r-p>0?r-p:10;o(n).css("left",e+"px")}else o(n).css("left",r+d+"px");if(window.innerHeight<c+s){let e=c-s<0?0:c-s;o(n).css("top",e+"px")}else o(n).css("top",c+"px");return n},createModal(t={}){let{actions:i}=t,a="";if(Array.isArray(i))for(let e of i)a+=`<span class="${e.class} vi-ui button tiny">${e.text}</span>`;return o(e.modal({...t,actionsHtml:a}))},removeModal(e){o(e).find(".vi-wbe-modal-container").remove(),o(".select2-container--open").remove()},getColFromColumnType:e=>n.idMappingFlip[e]||"",getProductTypeFromCell(e){let t=e.getAttribute("data-y"),i=this.getColFromColumnType("product_type");return this.jexcel.options.data[t]?this.jexcel.options.data[t][i]:null},getProductTypeFromY(e){let t=this.getColFromColumnType("product_type");return this.jexcel.options.data[e]?this.jexcel.options.data[e][t]:null},getReviewTypeFrom(e){let t=this.getColFromColumnType("comment_type");return this.jexcel.options.data[e]?this.jexcel.options.data[e][t]:null},getColumnType:e=>n.idMapping[e],stripHtml:e=>o(`<div>${e}</div>`).text(),getDataFromCell(e,t){let i=t.getAttribute("data-y"),a=t.getAttribute("data-x");return e.options.data[i][a]},getProductIdOfCell(e,t){if("object"==typeof t){let i=t.getAttribute("data-y");return e.options.data[i][0]}return e.options.data[t][0]},ajax(e={}){let t=Object.assign({url:wbeParams.ajaxUrl,type:"post",dataType:"json"},e);t.data.action="vi_wbe_ajax",t.data.vi_wbe_nonce=wbeParams.nonce,t.data.type=wbeParams.editType,o.ajax(t)},pagination(e,t){let i="",a=`<a class="item ${1===(t=parseInt(t))?"disabled":""}" data-page="${t-1}"><i class="icon angle left"> </i></a>`,n=`<a class="item ${t===(e=parseInt(e))?"disabled":""}" data-page="${t+1}"><i class="icon angle right"> </i></a>`,s=`<input type="number" class="vi-wbe-go-to-page" value="${t}" min="1" max="${e}"/>`;for(let a=1;a<=e;a++)[1,t-1,t,t+1,e].includes(a)&&(i+=`<a class="item ${t===a?"active":""}" data-page="${a}">${a}</a>`),a===t-2&&t-2>1&&(i+='<a class="item disabled">...</a>'),a===t+2&&t+2<e&&(i+='<a class="item disabled">...</a>');return`<div class="vi-ui pagination menu">${a} ${i} ${n} </div> ${s}`},spinner:()=>o('<span class="vi-wbe-spinner"><span class="vi-wbe-spinner-inner"> </span></span>'),is_loading(){return!!this._spinner},loading(){this._spinner=this.spinner(),o(".vi-wbe-menu-bar-center").html(this._spinner)},removeLoading(){this._spinner=null,o(".vi-wbe-menu-bar-center").html("")},notice(e,t="black"){let i=o(`<div class="vi-wbe-notice" style="color:${t}">${e}</div>`);o(".vi-wbe-menu-bar-center").html(i),setTimeout((function(){i.remove()}),5e3)},generateCouponCode(){let e="";for(var t=0;t<n.couponGenerate.char_length;t++)e+=n.couponGenerate.characters.charAt(Math.floor(Math.random()*n.couponGenerate.characters.length));return e=n.couponGenerate.prefix+e+n.couponGenerate.suffix,e},htmlEncode:e=>e.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"),showMessage({title:e="",message:t="",type:i="positive",duration:a=3e3}){const n=o("#vi-wbe-container").find("#vi-hui-toast");if(n.get(0)){const s=o("<div></div>"),l=setTimeout((function(){n.find(".vi-ui.message").remove()}),a+1e3);s.on("click",".icon.close",(function(e){n.find(".vi-ui.message").remove(),clearTimeout(l)})),n.children().length>0&&(n.find(".vi-hui-toast").first().remove(),clearTimeout(l));const r=(a/1e3).toFixed(2);"rtl"===o("html").attr("dir")?s.css({animation:`slideInRight ease .3s, fadeOut linear 1s ${r}s forwards`}):s.css({animation:`slideInLeft ease .3s, fadeOut linear 1s ${r}s forwards`}),s.addClass(`vi-ui ${i} message`),s.html(`<i class="close icon"></i>\n                          <div class="header">\n                            ${e}\n                          </div>\n                          <p>${t}</p>`),n.children().length>0?i!==n.find(".vi-ui.message").first().attr("class").split(/\s+/)[1]&&n.append(s):n.append(s)}}},r=jQuery;let c=null;class d{constructor(e,t){c||r("body").on("mousedown keydown",this.mousedown),c=this,this.popup=r(".vi-wbe-context-popup"),this.render(e,r(t))}mousedown(e){let t=r(e.target),i=r(".vi-wbe-context-popup");(27===e.which||!t.hasClass("vi-wbe-context-popup")&&0===t.closest(".vi-wbe-context-popup").length&&i.hasClass("vi-wbe-popup-active")&&!t.hasClass("select2-search__field"))&&(i.empty().removeClass("vi-wbe-popup-active"),r(".select2-container.select2-container--default.select2-container--open").remove())}render(e,t){let{popup:i}=this,a=t.offset(),n=a.left,s=a.top,o=t.innerWidth();i.empty(),i.addClass("vi-wbe-popup-active").html(e);let l=i.innerWidth(),c=i.innerHeight();if(window.innerWidth<n+l+o){let e=n-l>0?n-l:10;i.css("left",e+"px")}else i.css("left",n+o+"px");if(r("#vi-wbe-editor").innerHeight()<s+c){let e=s-c<0?0:s-c;i.css("top",e+"px")}else i.css("top",s+"px")}hide(){this.popup.removeClass("vi-wbe-popup-active")}}const u=jQuery;class p{constructor(e,t,i,a){this._data={},this._data.jexcel=e,this._data.x=parseInt(t),this._data.y=parseInt(i),this.run()}get(e){return this._data[e]||""}run(){let e=this.content(),t=u(`td[data-x=${this.get("x")||0}][data-y=${this.get("y")||0}]`);new d(e,t),e.on("click",".vi-wbe-apply-formula",this.applyFormula.bind(this)),e.on("change",".vi-wbe-rounded",this.toggleDecimalValue)}content(){return u(`<div class="vi-wbe-formula-container" style="display: flex;">\n                    <select class="vi-wbe-operator">\n                        <option value="+">+</option>\n                        <option value="-">-</option>\n                    </select>\n                    <input type="number" min="0" class="vi-wbe-value">\n                    <select class="vi-wbe-unit">\n                        <option value="fixed">n</option>\n                        <option value="percentage">%</option>\n                    </select>\n                    <select class="vi-wbe-rounded">\n                        <option value="no_round">${l.text("No round")}</option>\n                        <option value="round">${l.text("Round with decimal")}</option>\n                        <option value="round_up">${l.text("Round up")}</option>\n                        <option value="round_down">${l.text("Round down")}</option>\n                    </select>\n                    <input type="number" min="0" max="10" class="vi-wbe-decimal" value="0">\n                    <button type="button" class="vi-ui button mini vi-wbe-apply-formula">${l.text("OK")}</button>\n                </div>`)}applyFormula(e){let t=u(e.target).closest(".vi-wbe-formula-container"),i=t.find(".vi-wbe-operator").val(),a=parseFloat(t.find(".vi-wbe-value").val()),n=t.find(".vi-wbe-unit").val(),s=t.find(".vi-wbe-rounded").val(),o=parseInt(t.find(".vi-wbe-decimal").val()),l=this.get("jexcel");if(!a)return;let r=[],c=l.selectedContainer,d=c[1],p=c[3],h=c[0];function m(e){e=parseFloat(e.toString().replace(",","."));let t="percentage"===n?e*a/100:a,l="-"===i?e-t:e+t;switch(s){case"round":l=l.toFixed(o);break;case"round_up":l=Math.ceil(l);break;case"round_down":l=Math.floor(l)}return l}for(let e=d;e<=p;e++)if(l.records[e][h]&&!l.records[e][h].classList.contains("readonly")&&"none"!==l.records[e][h].style.display){let t=l.options.data[e][h]||0;console.log(t),r.push(l.updateCell(h,e,m(t))),l.updateFormulaChain(h,e,r)}l.setHistory({action:"setValue",records:r,selection:l.selectedCell}),l.updateTable()}toggleDecimalValue(){let e=u(this).closest(".vi-wbe-formula-container");e.find(".vi-wbe-decimal").hide(),"round"===u(this).val()&&e.find(".vi-wbe-decimal").show()}}class h{constructor(e,t,i,a){this._data={},this._data.jexcel=e,this._data.x=parseInt(t),this._data.y=parseInt(i),this.run()}get(e){return this._data[e]||""}run(){let e=this.content(),t=u(`td[data-x=${this.get("x")||0}][data-y=${this.get("y")||0}]`);new d(e,t),e.on("click",".vi-wbe-apply-formula",this.applyFormula.bind(this)),e.on("change",".vi-wbe-rounded",this.toggleDecimalValue)}content(){return u(`<div class="vi-wbe-formula-container" style="display: flex;">\n                    <span class="vi-wbe-operator vi-ui button basic small icon"><i class="icon minus"> </i></span>\n                    <input type="number" min="0" class="vi-wbe-value">\n                    <select class="vi-wbe-unit">\n                        <option value="percentage">%</option>\n                        <option value="fixed">n</option>\n                    </select>\n                    <select class="vi-wbe-rounded">\n                        <option value="no_round">${l.text("No round")}</option>\n                        <option value="round">${l.text("Round with decimal")}</option>\n                        <option value="round_up">${l.text("Round up")}</option>\n                        <option value="round_down">${l.text("Round down")}</option>\n                    </select>\n                    <input type="number" min="0" max="10" class="vi-wbe-decimal" value="0">\n                    <button type="button" class="vi-ui button mini vi-wbe-apply-formula">${l.text("OK")}</button>\n                </div>`)}applyFormula(e){let t=u(e.target).closest(".vi-wbe-formula-container"),i=parseFloat(t.find(".vi-wbe-value").val()),a=t.find(".vi-wbe-unit").val(),n=t.find(".vi-wbe-rounded").val(),s=parseInt(t.find(".vi-wbe-decimal").val()),o=this.get("jexcel");if(!i)return;let l=[],r=o.selectedContainer,c=r[1],d=r[3],p=r[0];function h(e){let t=(e=parseFloat(e.replace(",",".")))-("percentage"===a?e*i/100:i);switch(t=t>0?t:0,n){case"round":t=t.toFixed(s);break;case"round_up":t=Math.ceil(t);break;case"round_down":t=Math.floor(t)}return t}for(let e=c;e<=d;e++)if(o.records[e][p]&&!o.records[e][p].classList.contains("readonly")&&"none"!==o.records[e][p].style.display){let t=o.options.data[e][p-1]||0;l.push(o.updateCell(p,e,h(t))),o.updateFormulaChain(p,e,l)}o.setHistory({action:"setValue",records:l,selection:o.selectedCell}),o.updateTable()}toggleDecimalValue(){let e=u(this).closest(".vi-wbe-formula-container");e.find(".vi-wbe-decimal").hide(),"round"===u(this).val()&&e.find(".vi-wbe-decimal").show()}}class m{constructor(e,t,i,a){this._data={},this._data.jexcel=e,this._data.x=parseInt(t),this._data.y=parseInt(i),this.run()}get(e){return this._data[e]||""}run(){let e=this.content(),t=u(`td[data-x=${this.get("x")||0}][data-y=${this.get("y")||0}]`);new d(e,t),e.on("click",".vi-wbe-apply-formula",this.applyFormula.bind(this))}content(){return u(`<div class="vi-wbe-formula-container" style="display: flex; align-items: center; gap: 10px;">\n                    <label for="">${l.text("From")}</label>\n                    <input type="number" min="0" max="10" class="vi-wbe-fill-from" value="0">\n                    <label for="">${l.text("Step")}</label>\n                    <input type="number" min="0" max="10" class="vi-wbe-fill-step" value="1">\n                    <button type="button" class="vi-ui button mini vi-wbe-apply-formula">${l.text("Fill")}</button>\n                </div>`)}applyFormula(e){let t=u(e.target).closest(".vi-wbe-formula-container"),i=parseFloat(t.find(".vi-wbe-fill-from").val()),a=parseFloat(t.find(".vi-wbe-fill-step").val()),n=0,s=this.get("jexcel"),o=[],l=s.selectedContainer,r=l[1],c=l[3],d=l[0];for(let e=r;e<=c;e++)if(s.records[e][d]&&!s.records[e][d].classList.contains("readonly")&&"none"!==s.records[e][d].style.display){let t=i+a*n;o.push(s.updateCell(d,e,t.toString())),s.updateFormulaChain(d,e,o),n++}s.setHistory({action:"setValue",records:o,selection:s.selectedCell}),s.updateTable()}}const v=jQuery,b={init(){return v(".vi-ui.menu .item").vi_tab(),v(".bulky-sort-fields-accordion").vi_accordion(),v("#bulky-sort-fields").sortable({axis:"y",containment:"parent"}),this.revision={},this.sidebar=v("#vi-wbe-sidebar"),this.historyBodyTable=v("#vi-wbe-history-points-list tbody"),this.sidebar.on("click",".vi-wbe-apply-filter",this.applyFilter.bind(this)),this.sidebar.on("click",".vi-wbe-filter-label",this.filterInputLabelFocus),this.sidebar.on("focus",".vi-wbe-filter-input",this.filterInputFocus),this.sidebar.on("blur",".vi-wbe-filter-input",this.filterInputBlur),this.sidebar.on("click",".vi-wbe-get-meta-fields",this.getMetaFields.bind(this)),this.sidebar.on("click",".vi-wbe-save-meta-fields:not(.loading)",this.saveMetaFields.bind(this)),this.sidebar.on("click",".vi-wbe-add-new-meta-field",this.addNewMetaField.bind(this)),this.sidebar.find("table.vi-wbe-meta-fields-container tbody").sortable({axis:"y"}),this.sidebar.find("table.vi-wbe-meta-fields-container").on("click",".vi-wbe-remove-meta-row",this.removeMetaRow),this.sidebar.on("click",".vi-wbe-save-taxonomy-fields:not(.loading)",this.saveTaxonomyFields),this.sidebar.on("click",".vi-wbe-save-settings",this.saveSettings.bind(this)),this.sidebar.on("click",".vi-wbe-view-history-point",this.viewHistoryPoint.bind(this)),this.sidebar.on("click",".vi-wbe-recover",this.recover.bind(this)),this.sidebar.on("click",".vi-wbe-revert-this-point",this.revertAllProducts.bind(this)),this.sidebar.on("click",".vi-wbe-revert-this-key",this.revertProductAttribute.bind(this)),this.sidebar.on("click",".vi-wbe-pagination a.item",this.changePage.bind(this)),this.sidebar.on("change",".vi-wbe-go-to-page",this.changePageByInput.bind(this)),this.sidebar.on("click",".vi-wbe-multi-select-clear",this.clearMultiSelect),this.sidebar.on("change",".vi-wbe-meta-column-type",this.metaFieldChangeType),this.sidebar.on("keyup",".vi-wbe-search-metakey",this.searchMetaKey),this.filter(),this.settings(),this.metafields(),this.history(),this.sidebar},filter(){let e=v("#vi-wbe-products-filter"),t=v(".vi-wbe-filter-input"),i={top:-2},a={top:"50%"};t.each(((e,t)=>{v(t).val()&&v(t).parent().prev().css(i)})),t.on("focus",(function(){let e=v(this).prev();e.css(i),v(this).on("blur",(function(){v(this).val()||e.css(a)}))})),this.sidebar.on("click",".vi-wbe-filter-label",(function(){v(this).next().trigger("focus")}));let n=e.find(".vi-ui.compact.dropdown").dropdown();e.find(".vi-wbe.vi-ui.dropdown:not(.vi-wbe-filter-select2)").dropdown({clearable:!0,fullTextSearch:!0}),e.find(".vi-wbe.vi-ui.dropdown.vi-wbe-filter-select2").each((function(e,t){let i=v(t).data("placeholder"),a=v(t).attr("id").replace("vi-wbe-","");v(t).select2({placeholder:i,closeOnSelect:!1,multiple:!0,minimumInputLength:2,ajax:{url:wbeParams.ajaxUrl,dataType:"json",type:"POST",quietMillis:50,delay:250,data:function(e){return{action:"vi_wbe_ajax",vi_wbe_nonce:wbeParams.nonce,sub_action:"search_taxonomy",taxonomy_type:a,search:e.term}},processResults:function(e){return{results:e}}}})})),this.sidebar.on("click",".vi-wbe-clear-filter",(function(){v(".vi-wbe-filter-label").css(a),t.val(""),e.find("div.vi-wbe.vi-ui.dropdown").dropdown("clear"),e.find("select.vi-wbe.vi-ui.dropdown").val(null).trigger("change"),n.find(".menu .item:first").trigger("click")})),this.sidebar.on("change","#vi-wbe-has_expire_date",(function(){let e=v(".vi-wbe-expire-date-group");"yes"===v(this).val()?e.show():e.hide()})),this.sidebar.find("#vi-wbe-has_expire_date").trigger("change")},settings(){v(".vi-wbe-settings-tab").find("select.dropdown").dropdown()},metafields(){this.renderMetaFieldsTable(n.metaFields)},history(){this.pagination(1)},pagination(e,t=n.historyPages){this.sidebar.find(".vi-wbe-pagination").html(l.pagination(t,e))},applyFilter(e){let t=this,i=v(e.target);i.hasClass("loading")||l.ajax({data:{sub_action:"add_filter_data",filter_data:v("#vi-wbe-products-filter").serialize(),filter_key:n.filterKey},beforeSend(){i.addClass("loading")},success(e){t.sidebar.trigger("afterAddFilter",[e.data]),l.showMessage({title:"Success",message:"Filtered successfully",type:"positive",duration:3e3})},error(e){console.log(e),alert(e.statusText+e.responseText)},complete(){i.removeClass("loading")}})},limitProductPerPage(){let e=v(this).val();e>50&&v(this).val(50),e<0&&v(this).val(0)},saveSettings(e){let t=this,i=v(e.target);i.hasClass("loading")||l.ajax({data:{sub_action:"save_settings",fields:v("form.vi-wbe-settings-tab").serialize()},beforeSend(){i.addClass("loading")},success(e){e.success&&(n.settings=e.data.settings,t.sidebar.trigger("afterSaveSettings",[e.data]))},error(e){console.log(e),alert(e.statusText+e.responseText)},complete(){i.removeClass("loading")}})},filterInputLabelFocus(){v(this).next().find("input").trigger("focus")},filterInputFocus(){v(this).parent().prev().css({top:-2})},filterInputBlur(){v(this).val()||v(this).parent().prev().css({top:"50%"})},getMetaFields(e){let t=this,i=v(e.target);i.hasClass("loading")||l.ajax({data:{sub_action:"get_meta_fields",current_meta_fields:t.getCurrentMetaFields()},beforeSend(){i.addClass("loading")},success(e){t.renderMetaFieldsTable(e.data),n.metaFields=e.data},error(e){console.log(e),alert(e.statusText+e.responseText)},complete(){i.removeClass("loading")}})},renderMetaFieldsTable(e){let t="";for(let i in e)t+=this.renderRow(i,e);v(".vi-wbe-meta-fields-container tbody").html(t)},renderRow(e,t){let i=t[e]||{},a="",n=i.input_type||"",s={textinput:"Text input",texteditor:"Text editor",numberinput:"Number input",array:"Array",json:"JSON",checkbox:"Checkbox",calendar:"Calendar",image:"Image",select:"Select",multiselect:"Multiselect",gallery:"Gallery"},o=i.meta_value||"",l=o.slice(0,15),r=o.length>16?`<div class="vi-wbe-full-meta-value">${o}</div>`:"",c="";for(let e in s)a+=`<option value="${e}" ${e===n?"selected":""}>${s[e]}</option>`;return l+=l.length<o.length?"...":"","select"!==n&&"multiselect"!==n||(c+=`<textarea class="vi-wbe-select-options">${i.select_options}</textarea>`),`<tr>\n                    <td class="vi-wbe-meta-key">${e}</td>\n                    <td><input type="text" class="vi-wbe-meta-column-name" value="${i.column_name||""}"></td>\n                    <td>\n                        <div class="vi-wbe-display-meta-value">\n                            <div class="vi-wbe-short-meta-value">${l}</div>\n                            ${r}\n                        </div>\n                    </td>\n                    <td>\n                        <select class="vi-wbe-meta-column-type">${a}</select>\n                        ${c}\n                    </td>\n                    <td class="vi-wbe-meta-field-active-column">\n                        <div class="vi-ui toggle checkbox">\n                          <input type="checkbox" class="vi-wbe-meta-column-active" ${parseInt(i.active)?"checked":""}>\n                          <label> </label>\n                        </div>  \n                    </td>\n                    <td>\n                        <div class="vi-wbe-meta-field-actions">\n                            <span class="vi-ui button basic mini vi-wbe-remove-meta-row"><i class="icon trash"> </i></span>\n                            <span class="vi-ui button basic mini"><i class="icon move"> </i></span>\n                        </div>\n                    </td>\n                </tr>`},metaFieldChangeType(){let e=v('<textarea class="vi-wbe-select-options"></textarea>'),t=v(this).val(),i=v(this).siblings();"select"===t||"multiselect"===t?i.length||v(this).after(e):i.remove()},searchMetaKey(){let e=v(this).val().toLowerCase();v(".vi-wbe-meta-fields-container tbody tr").each((function(t,i){v(i).find(".vi-wbe-meta-key").text().trim().toLowerCase().indexOf(e)>-1?v(i).show():v(i).hide()}))},saveMetaFields(e){let t=v(e.target);t.hasClass("loading")||l.ajax({data:{sub_action:"save_meta_fields",meta_fields:this.getCurrentMetaFields()},beforeSend(){t.addClass("loading")},success(e){!1===e.success?alert(e.data.message):location.reload()},error(e){console.log(e),alert(e.statusText+e.responseText)},complete(){t.removeClass("loading")}})},getCurrentMetaFields(){let e={},t=n.metaFields;return v("table.vi-wbe-meta-fields-container tbody tr").each((function(i,a){let n=v(a).find(".vi-wbe-meta-key").text();e[n]={column_name:v(a).find(".vi-wbe-meta-column-name").val(),input_type:v(a).find(".vi-wbe-meta-column-type").val(),active:v(a).find(".vi-wbe-meta-column-active:checked").length,meta_value:t[n]?t[n].meta_value:"",select_options:v(a).find(".vi-wbe-select-options").val()}})),e},addNewMetaField(e){let t=v(e.currentTarget).prev(),i=t.val(),a=i.match(/^[\w\d_-]*$/g);if(!i||!a||n.metaFields[i])return;let s=this.renderRow(i,{});s&&(t.val(""),v("table.vi-wbe-meta-fields-container tbody").append(s))},removeMetaRow(){v(this).closest("tr").remove()},saveTaxonomyFields(e){let t=v(e.target),i=[];v("table.vi-wbe-taxonomy-fields .vi-wbe-taxonomy-active:checked").each((function(e,t){let a=v(this).closest("tr").find(".vi-wbe-taxonomy-key").text();i.push(a)})),l.ajax({data:{sub_action:"save_taxonomy_fields",taxonomy_fields:i},beforeSend(){t.addClass("loading")},success(e){t.removeClass("loading"),location.reload()},error(e){console.log(e),alert(e.statusText+e.responseText)},complete(){t.removeClass("loading")}})},viewHistoryPoint(e){let t=v(e.currentTarget),i=t.data("id"),a=this;t.hasClass("loading")||l.ajax({data:{sub_action:"view_history_point",id:i},beforeSend(){t.addClass("loading")},success(e){if(e.success&&e.data){let t=e.data.compare,n="";for(let e in t){let i=t[e];n+=`<div class="vi-wbe-history-product" data-product_id="${e}">\n                                        <div class="title">\n                                            <i class="dropdown icon"></i>\n                                            ${i.name}\n                                            <span class="vi-ui button mini basic vi-wbe-revert-this-product">\n                                                <i class="icon undo"> </i>\n                                            </span>\n                                            \n                                        </div>`;let a="";for(let t in i.fields){let n="string"==typeof i.current[t]?i.current[t]:JSON.stringify(i.current[t]),s="string"==typeof i.history[t]?i.history[t]:JSON.stringify(i.history[t]);a+=`<tr>\n                                            <td>${i.fields[t]}</td>\n                                            <td>${n}</td>\n                                            <td>${s}</td>\n                                            <td class="">\n                                                <span class="vi-ui button basic mini vi-wbe-revert-this-key" data-product_id="${e}" data-product_key="${t}">\n                                                    <i class="icon undo"> </i>\n                                                </span>\n                                            </td>\n                                        </tr>`}a=`<table id="vi-wbe-history-point-detail" class="vi-ui celled table">\n                                    <thead>\n                                    <tr>\n                                        <th>Attribute</th>\n                                        <th>Current</th>\n                                        <th>History</th>\n                                        <th class="">Revert</th>\n                                    </tr>\n                                    </thead>\n                                    <tbody>\n                                    ${a}\n                                    </tbody>\n                                </table>`,n+=`<div class="content">${a}</div></div>`}n=v(`<div class="vi-ui styled fluid accordion">${n}</div>`),v(".vi-wbe-history-review").html(n).attr("data-history_id",i).prepend(`<h4>History point: ${e.data.date}</h4>`).append(`<div class="vi-ui button tiny vi-wbe-revert-this-point">\n                                    ${l.text("Revert all product in this point")}\n                                </div>\n                                <p> ${l.text("The current value is the value of the records in database")}</p>`),n.find(".title").on("click",(e=>a.revertSingleProduct(e))),n.vi_accordion(),n.find(".title:first").trigger("click")}},error(e){console.log(e),alert(e.statusText+e.responseText)},complete(){t.removeClass("loading")}})},recover(e){let t=v(e.currentTarget),i=t.data("id");t.hasClass("loading")||l.ajax({data:{sub_action:"revert_history_all_products",history_id:i},beforeSend(){t.addClass("loading")},success(e){console.log(e),l.showMessage({title:"Success",message:"Reverted successfully",type:"positive",duration:3e3})},error(e){console.log(e),alert(e.statusText+e.responseText)},complete(){t.removeClass("loading")}})},revertSingleProduct(e){let t;if(v(e.target).hasClass("vi-wbe-revert-this-product")&&(t=v(e.target)),v(e.target).parent().hasClass("vi-wbe-revert-this-product")&&(t=v(e.target).parent()),t){e.stopImmediatePropagation();let i=t.closest(".vi-wbe-history-product").data("product_id"),a=t.closest(".vi-wbe-history-review").data("history_id");if(t.hasClass("loading"))return;l.ajax({data:{sub_action:"revert_history_single_product",history_id:a,pid:i},beforeSend(){t.addClass("loading")},success(e){console.log(e),l.showMessage({title:"Success",message:"Reverted successfully",type:"positive",duration:3e3})},error(e){console.log(e),alert(e.statusText+e.responseText)},complete(){t.removeClass("loading")}})}},revertAllProducts(e){let t=v(e.target),i=t.closest(".vi-wbe-history-review").data("history_id");t.hasClass("loading")||l.ajax({data:{sub_action:"revert_history_all_products",history_id:i},beforeSend(){t.addClass("loading")},success(e){console.log(e),l.showMessage({title:"Success",message:"Reverted successfully",type:"positive",duration:3e3})},error(e){console.log(e),alert(e.statusText+e.responseText)},complete(){t.removeClass("loading")}})},revertProductAttribute(e){let t=v(e.currentTarget),i=t.data("product_key"),a=t.closest(".vi-wbe-history-product").data("product_id"),n=t.closest(".vi-wbe-history-review").data("history_id");t.hasClass("loading")||l.ajax({data:{sub_action:"revert_history_product_attribute",attribute:i,history_id:n,pid:a},beforeSend(){t.addClass("loading")},success(e){console.log(e),l.showMessage({title:"Success",message:"Reverted Attribute successfully",type:"positive",duration:3e3})},error(e){console.log(e),alert(e.statusText+e.responseText)},complete(){t.removeClass("loading")}})},changePage(e){let t=parseInt(v(e.currentTarget).attr("data-page"));v(e.currentTarget).hasClass("active")||v(e.currentTarget).hasClass("disabled")||!t||this.loadHistoryPage(t)},changePageByInput(e){let t=parseInt(v(e.target).val());t<=parseInt(v(e.target).attr("max"))&&t>0&&this.loadHistoryPage(t)},clearMultiSelect(){v(this).parent().find(".vi-ui.dropdown").dropdown("clear")},loadHistoryPage(e){let t=l.spinner(),i=this;e&&l.ajax({dataType:"text",data:{sub_action:"load_history_page",page:e},beforeSend(){i.sidebar.find(".vi-wbe-pagination").prepend(t)},success(t){i.pagination(e),v("#vi-wbe-history-points-list tbody").html(t)},error(e){console.log(e),alert(e.statusText+e.responseText)},complete(){t.remove()}})}},f=jQuery;class g{constructor(e,t,i,a){this._data={},this._data.jexcel=e,this._data.x=parseInt(t),this._data.y=parseInt(i),this.run()}get(e){return this._data[e]||""}run(){let e=this.content(),t=f(`td[data-x=${this.get("x")||0}][data-y=${this.get("y")||0}]`);new d(e,t),e.on("click",".vi-wbe-apply-formula",this.applyFormula.bind(this))}content(){return f(`<div class="vi-wbe-formula-container">\n                    <div class="field">\n                        <input type="text" placeholder="${l.text("Find")}" class="vi-wbe-find-string">\n                    </div>\n                    <div class="field">\n                        <input type="text" placeholder="${l.text("Replace")}" class="vi-wbe-replace-string">\n                    </div>\n                    <button type="button" class="vi-ui button mini vi-wbe-apply-formula">${l.text("Replace")}</button>\n                </div>`)}applyFormula(e){let t=f(e.target).closest(".vi-wbe-formula-container"),i=t.find(".vi-wbe-find-string").val(),a=t.find(".vi-wbe-replace-string").val(),n=this.get("jexcel");if(!i)return;let s=[],o=n.selectedContainer,l=o[1],r=o[3],c=o[0];for(let e=l;e<=r;e++)if(n.records[e][c]&&!n.records[e][c].classList.contains("readonly")&&"none"!==n.records[e][c].style.display){let t=n.options.data[e][c].replaceAll(i,a);s.push(n.updateCell(c,e,t)),n.updateFormulaChain(c,e,s)}n.setHistory({action:"setValue",records:s,selection:n.selectedCell}),n.updateTable()}}const w=jQuery;class y{constructor(e,t,i,a,n){this._data={},this._data.jexcel=e,this._data.x=parseInt(t),this._data.y=parseInt(i),this._wordWrap=n,this.run()}get(e){return this._data[e]||""}run(){let e=this.content(),t=w(`td[data-x=${this.get("x")||0}][data-y=${this.get("y")||0}]`);new d(e,t),e.on("click",".vi-wbe-apply-formula",this.applyFormula.bind(this))}content(){let e=this._wordWrap?'<textarea class="vi-wbe-text-input" rows="3"></textarea>':`<input type="text" placeholder="${l.text("Content")}" class="vi-wbe-text-input">`;return w(`<div class="vi-wbe-formula-container">\n                    <div class="field">\n                        ${e}\n                    </div>\n                    <button type="button" class="vi-ui button mini vi-wbe-apply-formula">${l.text("Save")}</button>\n                </div>`)}applyFormula(e){let t=w(e.target).closest(".vi-wbe-formula-container").find(".vi-wbe-text-input").val(),i=this.get("jexcel"),a=[],n=i.selectedContainer,s=n[1],o=n[3],l=n[0];for(let e=s;e<=o;e++)i.records[e][l]&&!i.records[e][l].classList.contains("readonly")&&"none"!==i.records[e][l].style.display&&(a.push(i.updateCell(l,e,t)),i.updateFormulaChain(l,e,a));i.setHistory({action:"setValue",records:a,selection:i.selectedCell}),i.updateTable()}}const x=jQuery;class _{constructor(e,t,i,a,n){this.cells=t,this.obj=e,this.x=parseInt(i),this.y=parseInt(a),this.searchData=[],this.run()}run(){let e=this,t=this.content(),i=this.cells[1],a=this.cells[3],s=[{id:"",text:""}];for(let e=i;e<=a;e++){let t=this.obj.options.data[e][this.x];s.push(...t)}s=s.filter(((e,t,i)=>t===i.findIndex((t=>t.id===e.id&&t.text===e.text))));let o=x(`td[data-x=${this.x||0}][data-y=${this.y||0}]`);new d(t,o),t.find(".vi-wbe-find-string").select2({data:s}),t.find(".vi-wbe-replace-string").select2({multiple:!1,minimumInputLength:3,ajax:{url:n.ajaxUrl,type:"post",data:function(e){return{...n.ajaxData,sub_action:"search_tags",search:e.term,type:"public"}},processResults:function(t){return e.searchData=t,{results:t}}}}),t.on("click",".vi-wbe-apply-formula",this.applyFormula.bind(this))}content(){return x(`<div class="vi-wbe-formula-container">\n                    <div class="field">\n                        <div>${l.text("Find")}</div>\n                        <select placeholder="" class="vi-wbe-find-string"> </select>\n                    </div>\n                    <div class="field">\n                        <div>${l.text("Replace")}</div>\n                        <select placeholder="" class="vi-wbe-replace-string"> </select>\n                    </div>\n                    <button type="button" class="vi-ui button mini vi-wbe-apply-formula">${l.text("Replace")}</button>\n                    <p>If 'Find' value is empty, add to selected cells with 'Replace' value.</p>\n                    <p>If 'Replace' value is empty, remove from selected cells with 'Find' value.</p>\n                </div>`)}applyFormula(e){let t=x(e.target).closest(".vi-wbe-formula-container"),i=t.find(".vi-wbe-find-string").val(),a=t.find(".vi-wbe-replace-string").val(),n=this.obj;if(!i&&!a)return;let s=this.searchData.filter((e=>e.id===+a)),o=[],l=this.cells,r=l[1],c=l[3],d=l[0];for(let e=r;e<=c;e++)if(n.records[e][d]&&!n.records[e][d].classList.contains("readonly")&&"none"!==n.records[e][d].style.display){let t=n.options.data[e][d];t||(t=[]);let a=t.filter((e=>e.id!==+i));t.length===a.length&&i||a.push(...s),a=a.filter(((e,t,i)=>t===i.findIndex((t=>t.id===e.id&&t.text===e.text)))),o.push(n.updateCell(d,e,a)),n.updateFormulaChain(d,e,o)}n.setHistory({action:"setValue",records:o,selection:n.selectedCell}),n.updateTable()}}const C=jQuery;class k{constructor(e,t,i,a,n){this.cells=t,this.obj=e,this.x=parseInt(i),this.y=parseInt(a),this.searchData=[],this.source=e.options.columns[i].source||[],this.run()}run(){let e=this.content(),t=C(`td[data-x=${this.x||0}][data-y=${this.y||0}]`);new d(e,t),e.find(".vi-wbe-find-string").select2({data:[{id:"",text:""},...this.source]}),e.find(".vi-wbe-replace-string").select2({data:[{id:"",text:""},...this.source]}),e.on("click",".vi-wbe-apply-formula",this.applyFormula.bind(this))}content(){return C(`<div class="vi-wbe-formula-container">\n                    <div class="field">\n                        <div>${l.text("Find")}</div>\n                        <select placeholder="" class="vi-wbe-find-string"> </select>\n                    </div>\n                    <div class="field">\n                        <div>${l.text("Replace")}</div>\n                        <select placeholder="" class="vi-wbe-replace-string"> </select>\n                    </div>\n                    <button type="button" class="vi-ui button mini vi-wbe-apply-formula">${l.text("Replace")}</button>\n                    <p>If 'Find' value is empty, add to selected cells with 'Replace' value.</p>\n                    <p>If 'Replace' value is empty, remove from selected cells with 'Find' value.</p>\n                </div>`)}applyFormula(e){let t=C(e.target).closest(".vi-wbe-formula-container"),i=t.find(".vi-wbe-find-string").val(),a=t.find(".vi-wbe-replace-string").val(),n=this.obj;if(!i&&!a)return;i=isNaN(i)?i:+i,a=isNaN(a)?a:+a;let s=[],o=this.cells,l=o[1],r=o[3],c=o[0];for(let e=l;e<=r;e++)if(n.records[e][c]&&!n.records[e][c].classList.contains("readonly")&&"none"!==n.records[e][c].style.display){let t=n.options.data[e][c];t||(t=[]);let o=t.filter((e=>e!==i));t.length===o.length&&i||o.push(a),o=[...new Set(o)],s.push(n.updateCell(c,e,o)),n.updateFormulaChain(c,e,s)}n.setHistory({action:"setValue",records:s,selection:n.selectedCell}),n.updateTable()}}class T{constructor(e,t,i,a,n){this.cells=t,this.obj=e,this.x=parseInt(i),this.y=parseInt(a),this.run()}run(){let e=this;const t=wp.media({multiple:!0});t.open().off("select close").on("select",(function(i){t.state().get("selection").each((function(t){if("image"===(t=t.toJSON()).type){let i=t.id;n.imgStorage[i]=t.url,e.addImage(i)}}))}))}addImage(e){let t=this.obj,i=[],a=this.cells,n=a[1],s=a[3],o=a[0];for(let a=n;a<=s;a++)if(t.records[a][o]&&!t.records[a][o].classList.contains("readonly")&&"none"!==t.records[a][o].style.display){let n=t.options.data[a][o];n||(n=[]);let s=[...new Set(n)];s.push(e),i.push(t.updateCell(o,a,s)),t.updateFormulaChain(o,a,i)}t.setHistory({action:"setValue",records:i,selection:t.selectedCell}),t.updateTable()}}const $=jQuery;class A{constructor(e,t,i,a,n){this.cells=t,this.obj=e,this.x=parseInt(i),this.y=parseInt(a),this.run()}run(){let e=$(`td[data-x=${this.x||0}][data-y=${this.y||0}]`),t=this,i=l.createModal({header:l.text("Attributes"),content:"",actions:[{class:"save-attributes",text:l.text("Apply")}]});this.content(i),$(e).append(i),i.on("click",(function(e){let a=$(e.target);(a.hasClass("close")||a.hasClass("vi-wbe-modal-container"))&&i.remove(),a.hasClass("save-attributes")&&t.addAttributes(i)}))}addImage(e){let t=this.obj,i=[],a=this.cells,n=a[1],s=a[3],o=a[0];for(let a=n;a<=s;a++)if(t.records[a][o]&&!t.records[a][o].classList.contains("readonly")&&"none"!==t.records[a][o].style.display){let n=t.options.data[a][o];n||(n=[]);let s=[...new Set(n)];s.push(e),i.push(t.updateCell(o,a,s)),t.updateFormulaChain(o,a,i)}t.setHistory({action:"setValue",records:i,selection:t.selectedCell}),t.updateTable()}addAttributes(e){let t=[],i=e.find(".vi-wbe-add-attributes-option").val();if(e.find(".vi-wbe-attribute-row").each((function(e,i){let a=$(i).data("attr");if(a.is_taxonomy)a.options=$(i).find("select").val().map(Number);else{a.name=$(i).find("input.custom-attr-name").val();let e=$(i).find("textarea.custom-attr-val").val();a.value=e.trim().replace(/\s+/g," "),a.options=e.split("|").map((e=>e.trim().replace(/\s+/g," ")))}a.visible=!!$(i).find(".attr-visibility:checked").length,a.variation=!!$(i).find(".attr-variation:checked").length,a.position=e,t.push(a)})),t.length){let e=this.obj,a=!1,n=[],s=this.cells,o=s[1],l=s[3],r=s[0];const c=(e=[],t)=>{if(e.length)for(let i in e)if(e[i].name===t)return i;return!1};for(let s=o;s<=l;s++)if(e.records[s][r]&&!e.records[s][r].classList.contains("readonly")&&"none"!==e.records[s][r].style.display&&!1===a&&0===e.options.data[s][1]){let a=e.options.data[s][r];a||(a=[]);let o=[...new Set(a)],l=0;for(let a of t){let t=c(o,a.name);if(!1===t)a.position=o.length+l++,o.push(a);else switch(i){case"replace":a.position=o[t].position,o[t]=a;break;case"merge_terms":let i=[...o[t].options||[],...a.options||[]];o[t].options=[...new Set(i)],e.dispatch("onchange",e.ele,e.records[s]&&e.records[s][r]?e.records[s][r]:null,r,s,1,0)}}n.push(e.updateCell(r,s,o)),e.updateFormulaChain(r,s,n)}e.setHistory({action:"setValue",records:n,selection:e.selectedCell}),e.updateTable()}e.remove()}content(e){let t=this,i="",{attributes:a}=n,s=`<option value="">${l.text("Custom product attribute")}</option>`;for(let e in a)s+=`<option value="${e}">${a[e].data.attribute_label}</option>`;s=`<div class="vi-wbe-taxonomy-header">\n                            <select class="vi-wbe-select-taxonomy">${s}</select>\n                            <span class="vi-ui button tiny vi-wbe-add-taxonomy">${l.text("Add")}</span>\n                        </div>`,i=`${s}\n                <table class="vi-ui celled table">\n                    <thead>\n                    <tr>\n                        <th>Name</th>\n                        <th>Attributes</th>\n                        <th width="1">Actions</th>\n                    </tr>\n                    </thead>\n                    <tbody>${i}</tbody>\n                </table>`,e.find(".content").append(i),e.find(".actions").append('<div>\n                                        <div class="vi-wbe-add-attributes-option-label">\n                                            Select action if exist attribute in product\n                                        </div>\n                                        <select class="vi-wbe-add-attributes-option">\n                                            <option value="none">Don\'t add</option>\n                                            <option value="replace">Replace existed attribute</option>\n                                            <option value="merge_terms">Merge terms</option>\n                                        </select>\n                                    </div>'),e.find("table select").select2({multiple:!0}),e.find("tbody").sortable({items:"tr",cursor:"move",axis:"y",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",handle:".icon.move"});const o=()=>{e.find("select.vi-wbe-select-taxonomy option").removeAttr("disabled"),e.find("input[type=hidden]").each((function(t,i){let a=$(i).val();e.find(`select.vi-wbe-select-taxonomy option[value='${a}']`).attr("disabled","disabled")}))};o(),e.on("click",(function(i){let a=$(i.target);if(a.hasClass("trash")&&(a.closest("tr").remove(),o()),a.hasClass("vi-wbe-add-taxonomy")){let i=$(".vi-wbe-select-taxonomy"),a=i.val(),n={name:a,options:[]};a&&(n.is_taxonomy=1);let s=$(t.createRowTable(n));e.find("table tbody").append(s),s.find("select").select2({multiple:!0}),o(),i.val("").trigger("change")}if(a.hasClass("vi-wbe-select-all-attributes")){let e=a.closest("td").find("select");e.find("option").attr("selected",!0),e.trigger("change")}if(a.hasClass("vi-wbe-select-no-attributes")){let e=a.closest("td").find("select");e.find("option").attr("selected",!1),e.trigger("change")}if(a.hasClass("vi-wbe-add-new-attribute")){let e=prompt(l.text("Enter a name for the new attribute term:"));if(!e)return;let t=a.closest("tr.vi-wbe-attribute-row"),i=t.attr("data-attr");i&&(i=JSON.parse(i),l.ajax({data:{sub_action:"add_new_attribute",taxonomy:i.name,term:e},beforeSend(){a.addClass("loading")},success(e){if(e.success){let a=t.find("select");a.append(`<option value="${e.data.term_id}" selected>${e.data.name}</option>`),a.trigger("change"),n.attributes[i.name].terms[e.data.term_id]={slug:e.data.slug,text:e.data.name}}else alert(e.data.message)},complete(){a.removeClass("loading")}}))}}))}createRowTable(e){let t="",i="";if(e.is_taxonomy){let a=n.attributes[e.name],s=a.terms||[],o="";if(t=`${a.data.attribute_label}<input type="hidden" value="${e.name}"/>`,Object.keys(s).length)for(let t in s)o+=`<option value="${t}" ${e.options.includes(parseInt(t))?"selected":""}>${s[t].text}</option>`;i=`<select multiple>${o}</select>\n                    <div class="vi-wbe-attributes-button-group">\n                        <span class="vi-ui button mini vi-wbe-select-all-attributes">${l.text("Select all")}</span>\n                        <span class="vi-ui button mini vi-wbe-select-no-attributes">${l.text("Select none")}</span>\n                        <span class="vi-ui button mini vi-wbe-add-new-attribute">${l.text("Add new")}</span>\n                    </div>`}else t=`<input type="text" class="custom-attr-name" value="${e.name}" placeholder="${l.text("Custom attribute name")}"/>`,i=`<textarea class="custom-attr-val" placeholder="${l.text('Enter some text, or some attributes by "|" separating values.')}">${e.value||""}</textarea>`;return t=`<div class="vi-wbe-attribute-name-label">${t}</div>`,t+=`<div>\n                        <input type="checkbox" class="attr-visibility" ${e.visible?"checked":""} value="1">\n                        <label>${l.text("Visible on the product page")}</label>\n                    </div>`,t+=`<div>\n                        <input type="checkbox" class="attr-variation" ${e.variation?"checked":""} value="1">\n                        <label>${l.text("Used for variations (apply for variable)")}</label>\n                    </div>`,`<tr class="vi-wbe-attribute-row" data-attr='${JSON.stringify(e)}'>\n                    <td class="vi-wbe-left">${t}</td>\n                    <td>${i}</td>\n                    <td class="vi-wbe-right"><i class="icon trash"> </i> <i class="icon move"> </i></td>\n                </tr>`}}const S=jQuery;class E{constructor(e,t,i,a,n){this.cells=t,this.obj=e,this.x=parseInt(i),this.y=parseInt(a),this.run()}run(){let e=S(`td[data-x=${this.x||0}][data-y=${this.y||0}]`),t=this,i=l.createModal({header:l.text("Remove attributes"),content:"",actions:[{class:"save-attributes",text:l.text("Apply")}]});this.content(i),S(e).append(i),i.on("click",(function(e){let a=S(e.target);(a.hasClass("close")||a.hasClass("vi-wbe-modal-container"))&&i.remove(),a.hasClass("save-attributes")&&t.removeAttributes(i)}))}removeAttributes(e){let t=e.find(".vi-wbe-select-taxonomy").dropdown("get values");if(t.length){let e=this.obj,i=!1,a=[],n=this.cells,s=n[1],o=n[3],l=n[0];for(let n=s;n<=o;n++)if(e.records[n][l]&&!e.records[n][l].classList.contains("readonly")&&"none"!==e.records[n][l].style.display&&!1===i){let i=e.options.data[n][l];if(!i||!Array.isArray(i))continue;let s=i.filter((e=>!t.includes(e.name)));a.push(e.updateCell(l,n,s)),e.updateFormulaChain(l,n,a)}e.setHistory({action:"setValue",records:a,selection:e.selectedCell}),e.updateTable()}e.remove()}content(e){let{attributes:t}=n,i=`<option value="">${l.text("Select attributes to remove")}</option>`;for(let e in t)i+=`<option value="${e}">${t[e].data.attribute_label}</option>`;let a=`<div class="vi-wbe-taxonomy-header">\n                        <select class="vi-wbe-select-taxonomy fluid vi-ui selection" multiple>${i}</select>\n                    </div>`;e.find(".content").append(a),e.find("table select").select2({multiple:!0}),e.find("tbody").sortable({items:"tr",cursor:"move",axis:"y",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",handle:".icon.move"}),e.find(".vi-wbe-select-taxonomy").dropdown()}}var N=i(341);jQuery(document).ready((function(e){new class{constructor(){this.sidebar=b.init(),this.compare=[],this.trash=[],this.unTrash=[],this.revision={},this.isAdding=!1,this.editor=e("#vi-wbe-container"),this.menubar=e("#vi-wbe-menu-bar"),this.menubar.on("click",".vi-wbe-open-sidebar",this.openMenu.bind(this)),this.menubar.on("click","a.item:not(.vi-wbe-open-sidebar)",this.closeMenu.bind(this)),this.menubar.on("click",".vi-wbe-new-products",this.addNewProduct.bind(this)),this.menubar.on("click",".vi-wbe-new-coupons",this.addNewCoupon.bind(this)),this.menubar.on("click",".vi-wbe-new-orders",this.addNewOrder.bind(this)),this.menubar.on("click",".vi-wbe-full-screen-btn",this.toggleFullScreen.bind(this)),this.menubar.on("click",".vi-wbe-save-button",this.save.bind(this)),this.menubar.on("click",".vi-wbe-pagination a.item",this.changePage.bind(this)),this.menubar.on("click",".vi-wbe-get-product",this.reloadCurrentPage.bind(this)),this.menubar.on("change",".vi-wbe-go-to-page",this.changePageByInput.bind(this)),this.editor.on("cellonchange","tr",this.cellOnChange.bind(this)),this.editor.on("click",".jexcel_content",this.removeExistingEditor.bind(this)),this.editor.on("dblclick",this.removeContextPopup),this.sidebar.on("afterAddFilter",this.afterAddFilter.bind(this)),this.sidebar.on("afterSaveSettings",this.afterSaveSettings.bind(this)),this.sidebar.on("click",".vi-wbe-close-sidebar",this.closeMenu.bind(this)),this.sidebar.on("change","#vi-wbe-edit_fields, #vi-wbe-exclude_edit_fields",this.toggleSortFields.bind(this)),this.init(),e(document).on("keydown",this.keyDownControl.bind(this)),e(document).on("keyup",this.keyUpControl.bind(this))}removeExistingEditor(e){e.target===e.currentTarget&&this.WorkBook&&this.WorkBook.edition&&this.WorkBook.closeEditor(this.WorkBook.edition[0],!0)}keyDownControl(e){!e.ctrlKey&&!e.metaKey||e.shiftKey||83===e.which&&(e.preventDefault(),this.save()),27===e.which&&this.sidebar.removeClass("vi-wbe-open")}keyUpControl(e){if(e.target&&!e.target.getAttribute("readonly")){let t=e.target.getAttribute("data-currency");if(t){let i=e.target.value;if(i)if(i.indexOf(t)<1){let t=i.match(/\d/g);e.target.value=t?t.join(""):""}else{let a,n=i.split(t),s="";a=n[0].match(/[\d]/g).join(""),n[1]&&(s=n[1].match(/[\d]/g),s=s?s.join(""):""),e.target.value=s?`${a}${t}${s}`:`${a}${t}`}}}}removeContextPopup(){e(".vi-wbe-context-popup").removeClass("vi-wbe-popup-active")}init(){wbeParams.columns&&n.setColumns(wbeParams.columns),this.pagination(1,1),this.workBookInit(),this.loadProducts(),l.setJexcel(this.WorkBook)}cellOnChange(t,i){let{col:a=""}=i;if(!a)return;let s=n.idMapping[a],o=e(t.target);switch(s){case"product_type":o.find("td").each((function(t,i){let a=e(i).data("x");a&&0!==a&&1!==a&&e(i).removeClass("readonly")}));let t=n.cellDependType[i.value];Array.isArray(t)&&t.forEach((function(e){let t=n.idMappingFlip[e];o.find(`td[data-x='${t}']`).addClass("readonly")}));break;case"post_date":let a=l.getColFromColumnType("status");if(!o.find(`td[data-x='${a}']`).length)break;let s=i.value,r=o.find(`td[data-x='${a}']`).get(0),c=new Date(s).getTime()>Date.now()?"future":"publish";this.WorkBook.setValue(r,c)}}workBookInit(){let t,i=this,a=0,s=l.text("Delete rows with selected cells"),o=null,r=null;function c(e,t){let i=[],a=e.selectedContainer,n=a[1],s=a[3],o=a[0];for(let a=n;a<=s;a++)e.records[a][o]&&!e.records[a][o].classList.contains("readonly")&&"none"!==e.records[a][o].style.display&&(i.push(e.updateCell(o,a,t)),e.updateFormulaChain(o,a,i));e.setHistory({action:"setValue",records:i,selection:e.selectedCell}),e.updateTable()}switch(n.editType){case"products":s=`${l.text("Delete rows with selected cells")} \n                                            <span class="vi-wbe-context-menu-note">\n                                                (${l.text("Variations cannot revert after save")})\n                                            </span>`,o=function(t,i){let a=l.getProductTypeFromY(i),s=n.cellDependType[a];Array.isArray(s)&&s.forEach((function(i){let a=n.idMappingFlip[i];e(t).find(`td[data-x='${a}']`).addClass("readonly")}))},r=function(t,i,a,s,o,l){if(i===s&&a===o){let t=this.getCellFromCoords(i,a),s=e(t).children();if(s.length&&s.hasClass("vi-wbe-gallery-has-item")){let s=this.options.data[a][i],o="";if(s.length)for(let e of s)o+=`<li class="vi-wbe-gallery-image"><img src="${n.imgStorage[e]}"></li>`;new d(`<ul class="vi-wbe-gallery-images">${o}</ul>`,e(t))}}},t=function(t,a,s,o,r){i.removeContextPopup();let d=a.selectedContainer;if(s=parseInt(s),o=parseInt(o),d[0]===d[2]&&null!==s)switch(a.options.columns[s].type){case"checkbox":t.push({title:l.text("Check"),onclick(e){c(a,!0)}}),t.push({title:l.text("Uncheck"),onclick(e){c(a,!1)}});break;case"number":t.push({title:l.text("Calculator"),onclick(e){new p(a,s,o,e)}}),t.push({title:l.text("Fill"),onclick(e){new m(a,s,o,e)}}),s>1&&"sale_price"===a.options.columns[s].id&&"regular_price"===a.options.columns[s-1].id&&t.push({title:l.text("Calculator base on Regular price"),onclick(e){new h(a,s,o,e)}});break;case"text":t.push({title:l.text("Edit multiple cells"),onclick(e){new y(a,s,o,e,a.options.columns[s].wordWrap)}}),t.push({title:l.text("Find and Replace"),onclick(e){new g(a,s,o,e)}});break;case"calendar":let i=e(`td[data-x=${s}][data-y=${o}]`).get(0);e(i).hasClass("readonly")||t.push({title:l.text("Open date picker"),onclick(){let e=a.options.data[o][s];var t=l.createEditor(i,"input","",!1);t.value=e,t.style.left="unset";let n=a.selectedContainer,r=n[1],c=n[3];1!=a.options.tableOverflow&&1!=a.options.fullscreen||(a.options.columns[s].options.position=!0),a.options.columns[s].options.value=a.options.data[o][s],a.options.columns[s].options.opened=!0,a.options.columns[s].options.onclose=function(e,t){let i=[];t=e.value;for(let e=r;e<=c;e++)a.records[e][s]&&!a.records[e][s].classList.contains("readonly")&&"none"!==a.records[e][s].style.display&&(i.push(a.updateCell(s,e,t)),a.updateFormulaChain(s,e,i));a.setHistory({action:"setValue",records:i,selection:a.selectedCell}),a.updateTable()},jSuites.calendar(t,a.options.columns[s].options),t.focus()}});break;case"custom":switch(a.options.columns[s].editor.type){case"textEditor":t.push({title:l.text("Edit multiple cells"),onclick(){e(".vi-ui.modal").modal("show"),e(".vi-ui.modal .close.icon").off("click"),null===tinymce.get("vi-wbe-text-editor")?(e("#vi-wbe-text-editor").val(""),wp.editor.initialize("vi-wbe-text-editor",n.tinyMceOptions)):tinymce.get("vi-wbe-text-editor").setContent(""),e(".vi-wbe-text-editor-save").off("click").on("click",(function(){let t=wp.editor.getContent("vi-wbe-text-editor");c(a,t),e(this).hasClass("vi-wbe-close")&&e(".vi-ui.modal").modal("hide")}))}});break;case"tags":t.push({title:l.text("Find and replace tags"),onclick(e){new _(a,d,s,o,e)}});break;case"select2":t.push({title:l.text("Find and replace options"),onclick(e){new k(a,d,s,o,e)}});break;case"gallery":t.push({title:l.text("Add image to selected cells"),onclick(e){new T(a,d,s,o,e)}});break;case"product_attributes":t.push({title:l.text("Add attributes to products"),onclick(e){new A(a,d,s,o,e)}}),t.push({title:l.text("Remove multiple product attribute"),onclick(e){new E(a,d,s,o,e)}})}}if(t.length&&t.push({type:"line"}),d[1]===d[3]&&null!==o&&!isNaN(o)){let e=l.getProductTypeFromY(o);if("variable"===e&&(t.push({title:l.text("Add variation"),onclick(){l.is_loading()||l.ajax({data:{sub_action:"add_variation",pid:l.getProductIdOfCell(a,o)},beforeSend(){l.loading()},success(e){e.success&&(a.insertRow(0,o,!1,!0),a.setRowData(o+1,e.data,!0))},error(e){console.log(e),alert(e.statusText+e.responseText)},complete(){l.removeLoading()}})}}),t.push({title:`${l.text("Create variations from all attributes")} <span class="vi-wbe-context-menu-note">(${l.text("Save new attributes before")})</span>`,onclick(){l.is_loading()||l.ajax({data:{sub_action:"link_all_variations",pid:l.getProductIdOfCell(a,o)},beforeSend(){l.loading()},success(e){e.success&&(e.data.length&&e.data.forEach((function(e,t){a.insertRow(0,o+t,!1,!0),a.setRowData(o+t+1,e,!0)})),l.removeLoading(),l.notice(`${e.data.length} ${l.text("variations are added")}`))},error(e){console.log(e),alert(e.statusText+e.responseText)},complete(){l.removeLoading()}})}}),t.push({type:"line"})),"variation"!==e){let e=l.getProductIdOfCell(a,o);t.push({title:l.text("Duplicate"),onclick(){l.ajax({data:{sub_action:"duplicate_product",product_id:e},beforeSend(){l.loading()},success(e){e.data.length&&e.data.forEach((function(e,t){a.insertRow(0,o+t,!0,!0),a.setRowData(o+t,e,!0)}))},error(e){console.log(e),alert(e.statusText+e.responseText)},complete(){l.removeLoading()}})}}),t.push({title:l.text("Go to edit product page"),onclick(){window.open(`${n.adminUrl}post.php?post=${e}&action=edit`,"_blank")}}),t.push({title:l.text("View on Single product page"),onclick(){window.open(`${n.frontendUrl}?p=${e}&post_type=product&preview=true`,"_blank")}})}}return t};break;case"orders":t=function(t,i,a,s,o){let r=i.selectedContainer;if(a=parseInt(a),s=parseInt(s),null!==a&&null!==s){for(let e in n.orderActions)t.push({title:n.orderActions[e],onclick(){let t=[];for(let e=r[1];e<=r[3];e++)t.push(l.getProductIdOfCell(i,e));l.ajax({data:{sub_action:e,order_ids:t},beforeSend(){l.loading()},success(e){},error(e){console.log(e),alert(e.statusText+e.responseText)},complete(){l.removeLoading()}})}});t.length&&t.push({type:"line"});const a=function(t=0){let a=i.getCellFromCoords(r[0],r[1]),n=e(`<div>\n                                                    <div class="field"> \n                                                        <textarea rows="3"></textarea>\n                                                    </div>\n                                                    <div class="field"> \n                                                        <span class="vi-wbe-add-note vi-ui button tiny">\n                                                            ${l.text("Add")}\n                                                        </span>\n                                                    </div>\n                                                </div>`),s=new d(n,e(a));n.on("click",".vi-wbe-add-note",(function(){let e=n.find("textarea").val();if(!e)return;let a=i.selectedContainer,o=a[1],r=a[3],c=(a[0],[]);for(let e=o;e<=r;e++)c.push(i.options.data[e][0]);s.hide(),l.ajax({data:{sub_action:"add_order_note",ids:c,note:e,is_customer_note:t},beforeSend(){l.loading()},success(e){},error(e){console.log(e),alert(e.statusText+e.responseText)},complete(){l.removeLoading()}})}))};if(t.push({title:l.text("Add private note"),onclick(){a(0)}}),t.push({title:l.text("Add note to customer"),onclick(){a(1)}}),t.length&&t.push({type:"line"}),r[1]===r[3]){let e=l.getProductIdOfCell(i,s);t.push({title:l.text("Go to edit order page"),onclick(){window.open(`${n.adminUrl}post.php?post=${e}&action=edit`,"_blank")}}),t.length&&t.push({type:"line"})}}return t};break;case"coupons":t=function(e,t,i,a,n){let s=t.selectedContainer;return i=parseInt(i),a=parseInt(a),null!==i&&null!==a&&s[0]===s[2]&&("code"===l.getColumnType(i)&&e.push({title:l.text("Generate coupon code"),onclick(){let e=[],i=t.selectedContainer,a=i[1],n=i[3],s=i[0];for(let i=a;i<=n;i++)if(t.records[i][s]&&!t.records[i][s].classList.contains("readonly")&&"none"!==t.records[i][s].style.display){let a=l.generateCouponCode();e.push(t.updateCell(s,i,a)),t.updateFormulaChain(s,i,e)}t.setHistory({action:"setValue",records:e,selection:t.selectedCell}),t.updateTable()}}),"text"===t.options.columns[i].type&&(e.push({title:l.text("Edit multiple cells"),onclick(e){new y(t,i,a,e,t.options.columns[i].wordWrap)}}),e.push({title:l.text("Find and Replace"),onclick(e){new g(t,i,a,e)}})),"checkbox"===t.options.columns[i].type&&(e.push({title:l.text("Check"),onclick(e){c(t,!0)}}),e.push({title:l.text("Uncheck"),onclick(e){c(t,!1)}})),e.length&&e.push({type:"line"})),e};break;case"reviews":o=function(t,i){let a=l.getReviewTypeFrom(i),s=n.cellDependType[a];Array.isArray(s)&&s.forEach((function(i){let a=n.idMappingFlip[i];e(t).find(`td[data-x='${a}']`).addClass("readonly")}))},t=function(t,a,s,o,r){let d=a.selectedContainer;if(s=parseInt(s),o=parseInt(o),null!==s&&null!==o){if(d[0]===d[2])switch(a.options.columns[s].type){case"text":t.push({title:l.text("Edit multiple cells"),onclick(e){new y(a,s,o,e,a.options.columns[s].wordWrap)}}),t.push({title:l.text("Find and Replace"),onclick(e){new g(a,s,o,e)}});break;case"number":t.push({title:l.text("Find and Replace"),onclick(e){new g(a,s,o,e)}});break;case"checkbox":t.push({title:l.text("Check"),onclick(e){c(a,!0)}}),t.push({title:l.text("Uncheck"),onclick(e){c(a,!1)}});break;case"calendar":let i=e(`td[data-x=${s}][data-y=${o}]`).get(0);e(i).hasClass("readonly")||t.push({title:l.text("Open date picker"),onclick(){let e=a.options.data[o][s];var t=l.createEditor(i,"input","",!1);t.value=e,t.style.left="unset";let n=a.selectedContainer,r=n[1],c=n[3];1!=a.options.tableOverflow&&1!=a.options.fullscreen||(a.options.columns[s].options.position=!0),a.options.columns[s].options.value=a.options.data[o][s],a.options.columns[s].options.opened=!0,a.options.columns[s].options.onclose=function(e,t){let i=[];t=e.value;for(let e=r;e<=c;e++)a.records[e][s]&&!a.records[e][s].classList.contains("readonly")&&"none"!==a.records[e][s].style.display&&(i.push(a.updateCell(s,e,t)),a.updateFormulaChain(s,e,i));a.setHistory({action:"setValue",records:i,selection:a.selectedCell}),a.updateTable()},jSuites.calendar(t,a.options.columns[s].options),t.focus()}});break;case"custom":"textEditor"===a.options.columns[s].editor.type&&t.push({title:l.text("Edit multiple cells"),onclick(){e(".vi-ui.modal").modal("show"),e(".vi-ui.modal .close.icon").off("click"),null===tinymce.get("vi-wbe-text-editor")?(e("#vi-wbe-text-editor").val(""),wp.editor.initialize("vi-wbe-text-editor",n.tinyMceOptions)):tinymce.get("vi-wbe-text-editor").setContent(""),e(".vi-wbe-text-editor-save").off("click").on("click",(function(){let t=wp.editor.getContent("vi-wbe-text-editor");c(a,t),e(this).hasClass("vi-wbe-close")&&e(".vi-ui.modal").modal("hide")}))}})}let r=null;if("object"==typeof o){let e=e.getAttribute("data-y");r=a.options.data[e][1]}else r=a.options.data[o][1];t.push({type:"line"}),t.push({title:l.text("Reply"),onclick(){e(".vi-ui.modal").modal("show"),e(".vi-ui.modal .close.icon").off("click"),null===tinymce.get("vi-wbe-text-editor")?(e("#vi-wbe-text-editor").val(""),wp.editor.initialize("vi-wbe-text-editor",n.tinyMceOptions)):tinymce.get("vi-wbe-text-editor").setContent(""),e(".vi-wbe-text-editor-save").off("click").on("click",(function(){let t=a.selectedContainer,n=t[1],s=t[3],o=(t[0],wp.editor.getContent("vi-wbe-text-editor")),r=[];for(let e=n;e<=s;e++)r.push({comment_id:l.getDataFromCell(a,a.records[e][0]),product_id:l.getDataFromCell(a,a.records[e][1])});i.addNewReply(o,r),e(this).hasClass("vi-wbe-close")&&e(".vi-ui.modal").modal("hide")}))}}),d[1]===d[3]&&t.push({title:l.text("View on Single product page"),onclick(){window.open(`${n.frontendUrl}?p=${r}&post_type=product&preview=true`,"_blank")}})}return t}}this.WorkBook=e("#vi-wbe-spreadsheet").jexcel({allowInsertRow:!1,allowInsertColumn:!1,about:!1,freezeColumns:3,tableOverflow:!0,tableWidth:"100%",tableHeight:"100%",columns:n.columns,stripHTML:!1,allowExport:!1,allowDeleteColumn:!1,allowRenameColumn:!1,autoIncrement:!1,allowXCopy:!1,lazyLoading:!0,loadingSpin:!0,fullscreen:!0,text:{deleteSelectedRows:s},oncreaterow:o,contextMenuItems:t,onselection:r,onresizecolumn:function(e,t,i){l.ajax({async:!0,data:{sub_action:"resize_column",column_id:n.columns[t].id,column_width:i<=55?55:i},beforeSend(){},success(e){e.success&&console.log(e.data)},error(e){console.log(e.data),alert(e.data)},complete(){}})},rowDrag:"yes"!==wbeParams?.settings?.load_variations,onchange(t,a,n,s,o,r){if(JSON.stringify(o)!==JSON.stringify(r)){e(a).parent().trigger("cellonchange",{cell:a,col:n,row:s,value:o});let t=this.options.data[s][0];if(i.compare.push(t),i.compare=[...new Set(i.compare)],i.menubar.find(".vi-wbe-save-button").addClass("vi-wbe-saveable"),!i.isAdding){i.revision[t]||(i.revision[t]={});let e=l.getColumnType(n);i.revision[t][e]=r}}},onbeforechange:(e,t,i,a,n)=>("object"!=typeof n&&(n=N.sanitize(n)),n),ondeleterow(e,t,a,n){for(let e of n)i.trash.push(e[0].innerText);i.trash.length&&i.menubar.find(".vi-wbe-save-button").addClass("vi-wbe-saveable")},onundo(e,t){if(t&&"deleteRow"===t.action)for(let e of t.rowData)i.unTrash.push(e[0])},onbeforecopy(){a=0,i.firstCellCopy=null},oncopying(e,t,n){i.firstCellCopy||(i.firstCellCopy=[t,n]),i.firstCellCopy[0]!==t&&a++},onbeforepaste(e,t){if("string"!=typeof e)return e;e=e.trim();let n=t[0],s=this.columns[n].type;if(void 0===i.firstCellCopy)return["text","number","custom"].includes(s)?"custom"===s?"textEditor"===this.columns[n].editor.type?e:"":e:"";let o=+i.firstCellCopy[0],l=+t[0],r=this.columns[o].type,c=this.columns[l].type;if(+i.firstCellCopy[0]!=+t[0]){if(a>0)return alert("Copy single column each time."),"";if(r!==c)return alert("Can not paste data with different column type."),""}return e},onscroll(t){let i=e(t).find("select.select2-hidden-accessible");i.length&&i.select2("close")},oncreateeditor(e,t,i,a,n){this.options.columns[i].currency&&n.setAttribute("data-currency",this.options.columns[i].currency)}})}closeMenu(e){this.sidebar.removeClass("vi-wbe-open")}openMenu(t){let i=e(t.currentTarget).data("menu_tab"),a=this.sidebar.find(`a.item[data-tab='${i}']`);a.hasClass("active")&&this.sidebar.hasClass("vi-wbe-open")?this.sidebar.removeClass("vi-wbe-open"):(this.sidebar.addClass("vi-wbe-open"),a.trigger("click"))}toggleSortFields(t){let i=this.sidebar.find("#bulky-sort-fields"),a=this.sidebar.find("#vi-wbe-exclude_edit_fields").val(),n=this.sidebar.find("#vi-wbe-edit_fields").val();n.length?(i.find(".bulky-sort-field").addClass("vi-wbe-hidden"),e.each(n,(function(e,t){i.find(".bulky-sort-field-"+t).removeClass("vi-wbe-hidden")}))):i.find(".bulky-sort-field").removeClass("vi-wbe-hidden"),a.length&&e.each(a,(function(e,t){i.find(".bulky-sort-field-"+t).addClass("vi-wbe-hidden")}))}addNewProduct(){if(l.is_loading())return;let e=prompt(l.text("Please enter new product name"));if(e){let t=this;l.ajax({data:{sub_action:"add_new_product",product_name:e},beforeSend(){l.loading()},success(e){t.isAdding=!0,t.WorkBook.insertRow(0,0,!0,!0),t.WorkBook.setRowData(0,e.data,!0)},error(e){console.log(e),alert(e.statusText+e.responseText)},complete(){t.isAdding=!1,l.removeLoading()}})}}addNewCoupon(){if(l.is_loading())return;let e=this;l.ajax({data:{sub_action:"add_new_coupon"},beforeSend(){l.loading()},success(t){e.isAdding=!0,e.WorkBook.insertRow(0,0,!0,!0),e.WorkBook.setRowData(0,t.data,!0)},error(e){console.log(e),alert(e.statusText+e.responseText)},complete(){e.isAdding=!1,l.removeLoading()}})}addNewOrder(){window.open("post-new.php?post_type=shop_order")}addNewReply(e,t){if(l.is_loading())return;let i=this;l.ajax({data:{sub_action:"add_new_reply",content:e,new_comments:t},beforeSend(){l.loading()},success(e){console.log(e.data),i.isAdding=!1,l.removeLoading(),i.reloadCurrentPage()},error(e){console.log(e),alert(e.statusText+e.responseText)},complete(){i.isAdding=!1,l.removeLoading()}})}toggleFullScreen(t){let i=e(".wp-admin"),a=e(t.currentTarget);i.toggleClass("vi-wbe-full-screen"),i.hasClass("vi-wbe-full-screen")?(a.find("i.icon").removeClass("external alternate").addClass("window close outline"),a.attr("title","Exit full screen")):(a.find("i.icon").removeClass("window close outline").addClass("external alternate"),a.attr("title","Full screen")),e.ajax({url:n.ajaxUrl,type:"post",dataType:"json",data:{...n.ajaxData,sub_action:"set_full_screen_option",status:i.hasClass("vi-wbe-full-screen")}})}getAllRows(){return this.WorkBook.getData(!1,!0)}save(){e("td.error").removeClass("error");let t=this,i=this.getAllRows(),a=[],n=[];for(let e of this.compare)for(let t of i)parseInt(t[0])===parseInt(e)&&a.push(t);l.is_loading()||function i(s=0){let o=20*s,r=o+20,c=a.slice(o,r),d=20*s>=a.length;if(0!==c.length||0!==t.trash.length||0!==t.unTrash.length||0!==s){if(d&&s>0){if(n.length){l.notice(l.text("Invalid or duplicated SKU"));let i=l.getColFromColumnType("sku"),a=t.WorkBook.getData();if(a.length)for(let s in a){let o=a[s];if(n.includes(o[0])){let a=t.WorkBook.getCellFromCoords(i,s);e(a).addClass("error")}}}let i=t.WorkBook.history;if(i.length)for(let e of i){if("deleteRow"!==e.action)continue;let t=[];for(let i in e.rowData)e.rowData[i][1]>0&&t.push(parseInt(i));t.length&&(e.rowData=e.rowData.filter(((e,i)=>!t.includes(i))),e.rowNode=e.rowNode.filter(((e,i)=>!t.includes(i))),e.rowRecords=e.rowRecords.filter(((e,i)=>!t.includes(i))),e.numOfRows=e.numOfRows-t.length)}return t.saveRevision(),l.showMessage({title:"Success",message:"Saved successfully",type:"positive",duration:3e3}),void l.removeLoading()}l.ajax({data:{sub_action:"save_products",products:JSON.stringify(c),trash:t.trash,untrash:t.unTrash},beforeSend(){l.loading()},success(e){t.trash=[],t.unTrash=[],t.compare=[],t.menubar.find(".vi-wbe-save-button").removeClass("vi-wbe-saveable"),e.data.skuErrors&&(n=[...new Set([...n,...e.data.skuErrors])]),i(s+1)},error(e){console.log(e),l.showMessage({title:"Error",message:e.statusText+e.responseText,type:"positive",duration:3e3}),alert(e.statusText+e.responseText)},complete(){}})}else l.notice(l.text("Nothing change to save"))}()}textWrapMode(t){t?e("#vi-wbe-spreadsheet").addClass("vibulky-spreadsheet-wrap-mode"):e("#vi-wbe-spreadsheet").removeClass("vibulky-spreadsheet-wrap-mode")}loadProducts(e=1,t=!1){let i=this;l.is_loading()||(i.textWrapMode(i.sidebar.find('input[name="wrap_mode"]').prop("checked")),l.ajax({data:{sub_action:"load_products",page:e,re_create:t},beforeSend(){l.loading()},success(a){a.success&&(n.imgStorage=a.data.img_storage,t&&(i.WorkBook.destroy(),a.data.columns&&n.setColumns(a.data.columns),a.data.idMapping&&(n.idMapping=a.data.idMapping),a.data.idMappingFlip&&(n.idMappingFlip=a.data.idMappingFlip),i.workBookInit()),i.WorkBook.options.data=a.data.products,i.WorkBook.setData(),i.pagination(a.data.max_num_pages,e),i.WorkBook.orderAfterLoad(),a.data.products.length||l.notice(l.text("No item was found")))},error(e){console.log(e),alert(e.statusText+e.responseText)},complete(){l.removeLoading()}}))}pagination(e,t){this.menubar.find(".vi-wbe-pagination").html(l.pagination(e,t))}changePage(t){let i=parseInt(e(t.currentTarget).attr("data-page"));e(t.currentTarget).hasClass("active")||e(t.currentTarget).hasClass("disabled")||!i||this.loadProducts(i)}changePageByInput(t){let i=parseInt(e(t.target).val());i<=parseInt(e(t.target).attr("max"))&&i>0&&this.loadProducts(i)}reloadCurrentPage(){this.loadProducts(this.getCurrentPage())}getCurrentPage(){return this.menubar.find(".vi-wbe-pagination .item.active").data("page")||1}afterAddFilter(e,t){n.imgStorage=t.img_storage,this.WorkBook.options.data=t.products,this.WorkBook.setData(),this.pagination(t.max_num_pages,1),this.WorkBook.orderAfterLoad(),this.sidebar.find(".vi-wbe-close-sidebar").trigger("click"),t.products.length||l.notice(l.text("No item was found"))}afterSaveSettings(e,t){t.fieldsChange&&this.loadProducts(this.getCurrentPage(),!0),t?.fieldsRefresh?this.menubar.find(".vi-wbe-get-product").trigger("click"):this.sidebar.find(".vi-wbe-close-sidebar").trigger("click")}saveRevision(){let t=this;if(Object.keys(t.revision).length){let i=t.sidebar.find(".vi-wbe-pagination a.item.active").data("page")||1;l.ajax({data:{sub_action:"auto_save_revision",data:t.revision,page:i||1},success(a){a.success&&(a.data.updatePage&&e("#vi-wbe-history-points-list tbody").html(a.data.updatePage),t.revision={},t.sidebar.find(".vi-wbe-pagination").html(l.pagination(a.data.pages,i)))},error(e){console.log(e)}})}}}}))})()})();